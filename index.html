<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1e3a5f">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232ECC85'/%3E%3Cstop offset='100%25' style='stop-color:%231FAD73'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg transform='translate(50,50)'%3E%3Cpath d='M 0 -38 A 38 38 0 1 0 0 -37.99' fill='none' stroke='url(%23g)' stroke-width='8' stroke-linecap='round' stroke-dasharray='227 12'/%3E%3Cpath d='M0 -45 L0 -52' stroke='url(%23g)' stroke-width='6' stroke-linecap='round'/%3E%3C/g%3E%3C/svg%3E"><text y='.9em' font-size='90'>ğŸ </text></svg>">
  <title>ğŸ  å®¶åº­åº“å­˜ä¸­å¿ƒ</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --card-hover: #334155;
      --accent: #3b82f6;
      --accent-light: #60a5fa;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --border: #334155;
      --input-bg: #0f172a;
      --purple: #8b5cf6;
      --pink: #ec4899;
      --teal: #14b8a6;
      --orange: #f97316;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      padding-bottom: 120px;
    }
    .container { max-width: 500px; margin: 0 auto; }
    
    header { text-align: center; padding: 16px 0 20px; }
    h1 { font-size: 22px; margin-bottom: 4px; }
    .subtitle { color: var(--muted); font-size: 12px; }
    .save-status {
      font-size: 10px;
      color: var(--success);
      margin-top: 4px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .save-status.show { opacity: 1; }
    
    .sync-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      padding: 8px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    .sync-btn {
      padding: 6px 12px;
      background: linear-gradient(135deg, #4ecca3, #38b2ac);
      border: none;
      border-radius: 6px;
      color: #1a1a2e;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
    }
    .sync-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .sync-status { font-size: 11px; color: #888; }
    .sync-status.syncing { color: #f0ad4e; }
    .sync-status.synced { color: #4ecca3; }
    .sync-status.error { color: #e94560; }
    
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    .stat-card {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    .stat-value.warning { color: var(--warning); }
    .stat-value.danger { color: var(--danger); }
    .stat-label {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* ä¸»åˆ†ç±»ç½‘æ ¼ */
    .main-categories {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    .main-cat-card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .main-cat-card:hover { transform: translateY(-2px); }
    .main-cat-card.active { border-color: var(--accent); }
    .main-cat-card .icon { font-size: 32px; margin-bottom: 8px; }
    .main-cat-card .name { font-size: 14px; font-weight: 600; }
    .main-cat-card .count { font-size: 11px; color: var(--muted); margin-top: 4px; }
    .main-cat-card.daily { border-left: 4px solid var(--accent); }
    .main-cat-card.food { border-left: 4px solid var(--success); }
    .main-cat-card.clothing { border-left: 4px solid var(--purple); }
    .main-cat-card.sports { border-left: 4px solid var(--orange); }
    .main-cat-card.electronics { border-left: 4px solid var(--teal); }
    .main-cat-card.supplements { border-left: 4px solid #10b981; }

    .back-btn {
      display: none;
      padding: 10px 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 12px;
    }
    .back-btn.show { display: inline-flex; align-items: center; gap: 6px; }

    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
    }
    .tab {
      padding: 10px 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
      transition: all 0.2s;
    }
    .tab.active {
      background: var(--accent);
      border-color: var(--accent);
    }
    
    .category-view { display: none; }
    .category-view.active { display: block; }
    
    .section {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
      overflow: visible;
    }
    .section-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--accent-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .section-badge {
      font-size: 11px;
      padding: 4px 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      color: var(--muted);
    }
    
    .item-list { display: flex; flex-direction: column; gap: 8px; }
    
    .item {
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid rgba(255,255,255,0.05);
      transition: all 0.2s;
      position: relative;
    }
    .item.low-stock {
      border-color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
    }
    .item.out-of-stock {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    .item.ok {
      border-color: rgba(34, 197, 94, 0.3);
    }
    .item.expiring-soon {
      border-color: var(--orange);
      background: rgba(249, 115, 22, 0.1);
    }
    
    .item-icon {
      font-size: 22px;
      width: 36px;
      text-align: center;
    }
    .item-info { flex: 1; min-width: 0; }
    .item-name {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .item-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .item-meta .suggest { color: var(--accent-light); }
    .item-meta .expiry { color: var(--orange); }
    
    .item-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .item-qty {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .qty-btn {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .qty-btn:hover { border-color: var(--accent); }
    .qty-btn.minus { color: var(--danger); }
    .qty-btn.plus { color: var(--success); }
    .qty-value {
      font-size: 14px;
      font-weight: 700;
      min-width: 24px;
      text-align: center;
    }
    .delete-btn {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 14px;
      cursor: pointer;
      opacity: 0.5;
      transition: all 0.2s;
    }
    .delete-btn:hover {
      opacity: 1;
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .add-form {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    .form-group { flex: 1; }
    .form-group.small { flex: 0 0 70px; }
    .form-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 13px;
    }
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn-primary {
      background: var(--accent);
      color: white;
      width: 100%;
    }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-success {
      background: var(--success);
      color: white;
    }
    .btn-warning {
      background: var(--warning);
      color: white;
    }
    .btn-large {
      padding: 16px 24px;
      font-size: 15px;
      margin-bottom: 12px;
    }
    
    .quick-add {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .quick-btn {
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
    }
    .quick-btn:hover { border-color: var(--accent); }
    
    .shopping-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .shopping-item:last-child { border-bottom: none; }
    .shopping-check {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 2px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .shopping-check.checked {
      background: var(--success);
      border-color: var(--success);
    }
    .shopping-check.checked::after {
      content: 'âœ“';
      color: white;
      font-size: 12px;
    }
    .shopping-text { flex: 1; font-size: 13px; }
    .shopping-text.checked {
      text-decoration: line-through;
      color: var(--muted);
    }
    
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--success);
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 13px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    .empty-state .emoji { font-size: 48px; margin-bottom: 12px; }

    .alert-card {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(239, 68, 68, 0.15));
      border: 1px solid var(--warning);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .alert-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--warning);
      margin-bottom: 8px;
    }
    .alert-list {
      font-size: 12px;
      line-height: 1.6;
    }
    
    .edit-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    .edit-modal.hidden { display: none; }
    .edit-modal-content {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      width: 100%;
      max-width: 360px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .edit-modal h3 {
      font-size: 16px;
      margin-bottom: 16px;
      text-align: center;
    }

    /* æœç´¢æ¡† */
    .search-bar {
      margin-bottom: 16px;
    }
    .search-input {
      width: 100%;
      padding: 12px 16px;
      padding-left: 40px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 14px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 12px center;
      background-size: 20px;
    }
    .search-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* å­£èŠ‚æ ‡ç­¾ */
    .season-tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
    }
    .season-tag.spring { background: #86efac; color: #166534; }
    .season-tag.summer { background: #fcd34d; color: #92400e; }
    .season-tag.autumn { background: #fdba74; color: #9a3412; }
    .season-tag.winter { background: #93c5fd; color: #1e40af; }
    .season-tag.all { background: #e5e7eb; color: #374151; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ  å®¶åº­åº“å­˜ä¸­å¿ƒ</h1>
      <p class="subtitle">Dong & Olivia Â· å®¶åº­ç¬¬äºŒå¤§è„‘</p>
      <p class="save-status" id="saveStatus">âœ… å·²è‡ªåŠ¨ä¿å­˜</p>
      <div class="sync-bar">
        <button class="sync-btn" id="syncBtn" onclick="syncCloud()">â˜ï¸ äº‘åŒæ­¥</button>
        <span class="sync-status" id="syncStatus">ç‚¹å‡»åŒæ­¥</span>
      </div>
    </header>

    <!-- ä¸»è§†å›¾ï¼šåˆ†ç±»é€‰æ‹© -->
    <div id="mainView">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-value" id="totalItems">0</div>
          <div class="stat-label">æ€»ç‰©å“</div>
        </div>
        <div class="stat-card">
          <div class="stat-value warning" id="lowCount">0</div>
          <div class="stat-label">éœ€è¡¥è´§</div>
        </div>
        <div class="stat-card">
          <div class="stat-value danger" id="outCount">0</div>
          <div class="stat-label">å·²ç”¨å®Œ</div>
        </div>
      </div>

      <div id="alertSection" class="alert-card" style="display: none;">
        <div class="alert-title">âš ï¸ éœ€è¦æ³¨æ„</div>
        <div class="alert-list" id="alertList"></div>
      </div>

      <div class="search-bar">
        <input type="text" class="search-input" id="globalSearch" placeholder="æœç´¢æ‰€æœ‰åº“å­˜..." oninput="handleSearch(this.value)">
      </div>

      <div id="searchResults" style="display: none;"></div>

      <div id="categoryGrid" class="main-categories">
        <div class="main-cat-card daily" onclick="openCategory('daily')">
          <div class="icon">ğŸ§´</div>
          <div class="name">æ—¥ç”¨å“</div>
          <div class="count" id="dailyCount">0 ä»¶</div>
        </div>
        <div class="main-cat-card food" onclick="openCategory('food')">
          <div class="icon">ğŸ¥¬</div>
          <div class="name">é£Ÿæåº“å­˜</div>
          <div class="count" id="foodCount">0 ä»¶</div>
        </div>
        <div class="main-cat-card clothing" onclick="openCategory('clothing')">
          <div class="icon">ğŸ‘”</div>
          <div class="name">æ¢å­£è¡£ç‰©</div>
          <div class="count" id="clothingCount">0 ä»¶</div>
        </div>
        <div class="main-cat-card sports" onclick="openCategory('sports')">
          <div class="icon">ğŸƒ</div>
          <div class="name">è¿åŠ¨è£…å¤‡</div>
          <div class="count" id="sportsCount">0 ä»¶</div>
        </div>
        <div class="main-cat-card electronics" onclick="openCategory('electronics')">
          <div class="icon">ğŸ“±</div>
          <div class="name">ç”µå­äº§å“</div>
          <div class="count" id="electronicsCount">0 ä»¶</div>
        </div>
        <div class="main-cat-card supplements" onclick="openCategory('supplements')">
          <div class="icon">âš¡</div>
          <div class="name">è¿åŠ¨è¡¥ç»™</div>
          <div class="count" id="supplementsCount">0 ä»¶</div>
        </div>
        <div class="main-cat-card" style="border-left: 4px solid var(--pink);" onclick="openCategory('shopping')">
          <div class="icon">ğŸ›’</div>
          <div class="name">é‡‡ä¹°æ¸…å•</div>
          <div class="count" id="shoppingListCount">0 é¡¹</div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ’¾ æ•°æ®ç®¡ç†</div>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="exportData()">ğŸ“¤ å¯¼å‡º</button>
          <button class="btn btn-secondary" style="flex: 1;" onclick="importClick()">ğŸ“¥ å¯¼å…¥</button>
        </div>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
      </div>
    </div>

    <!-- æ—¥ç”¨å“è§†å›¾ -->
    <div id="dailyView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ§´ æ—¥ç”¨å“åº“å­˜</h2>
      
      <div class="tabs" id="dailyTabs">
        <button class="tab active" data-tab="medicine" onclick="showSubTab('daily', 'medicine', this)">ğŸ’Š è¯å“</button>
        <button class="tab" data-tab="hygiene" onclick="showSubTab('daily', 'hygiene', this)">ğŸ§´ å«ç”Ÿ</button>
        <button class="tab" data-tab="cleaning" onclick="showSubTab('daily', 'cleaning', this)">ğŸ§¹ æ¸…æ´</button>
        <button class="tab" data-tab="kitchen" onclick="showSubTab('daily', 'kitchen', this)">ğŸ³ å¨æˆ¿</button>
        <button class="tab" data-tab="other" onclick="showSubTab('daily', 'other', this)">ğŸ“¦ å…¶ä»–</button>
        <button class="tab" data-tab="add" onclick="showSubTab('daily', 'add', this)">â•</button>
      </div>

      <div id="daily-medicine" class="sub-tab-content active"></div>
      <div id="daily-hygiene" class="sub-tab-content"></div>
      <div id="daily-cleaning" class="sub-tab-content"></div>
      <div id="daily-kitchen" class="sub-tab-content"></div>
      <div id="daily-other" class="sub-tab-content"></div>
      <div id="daily-add" class="sub-tab-content"></div>
    </div>

    <!-- é£Ÿæåº“å­˜è§†å›¾ -->
    <div id="foodView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ¥¬ é£Ÿæåº“å­˜</h2>
      
      <div class="tabs" id="foodTabs">
        <button class="tab active" data-tab="fridge" onclick="showSubTab('food', 'fridge', this)">ğŸ§Š å†°ç®±</button>
        <button class="tab" data-tab="freezer" onclick="showSubTab('food', 'freezer', this)">â„ï¸ å†·å†»</button>
        <button class="tab" data-tab="pantry" onclick="showSubTab('food', 'pantry', this)">ğŸ¥« å‚¨ç‰©æŸœ</button>
        <button class="tab" data-tab="spices" onclick="showSubTab('food', 'spices', this)">ğŸ§‚ è°ƒæ–™</button>
        <button class="tab" data-tab="drinks" onclick="showSubTab('food', 'drinks', this)">ğŸ· é¥®å“</button>
        <button class="tab" data-tab="fitness" onclick="showSubTab('food', 'fitness', this)">ğŸ’ª å¥èº«</button>
        <button class="tab" data-tab="add" onclick="showSubTab('food', 'add', this)">â•</button>
      </div>

      <div id="food-fridge" class="sub-tab-content active"></div>
      <div id="food-freezer" class="sub-tab-content"></div>
      <div id="food-pantry" class="sub-tab-content"></div>
      <div id="food-spices" class="sub-tab-content"></div>
      <div id="food-drinks" class="sub-tab-content"></div>
      <div id="food-fitness" class="sub-tab-content"></div>
      <div id="food-add" class="sub-tab-content"></div>
    </div>

    <!-- æ¢å­£è¡£ç‰©è§†å›¾ -->
    <div id="clothingView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ‘” æ¢å­£è¡£ç‰©</h2>
      
      <div class="tabs" id="clothingTabs">
        <button class="tab active" data-tab="dong" onclick="showSubTab('clothing', 'dong', this)">ğŸ‘” Dong</button>
        <button class="tab" data-tab="olivia" onclick="showSubTab('clothing', 'olivia', this)">ğŸ‘— Olivia</button>
        <button class="tab" data-tab="bedding" onclick="showSubTab('clothing', 'bedding', this)">ğŸ›ï¸ åºŠå“</button>
        <button class="tab" data-tab="shoes" onclick="showSubTab('clothing', 'shoes', this)">ğŸ‘Ÿ é‹å­</button>
        <button class="tab" data-tab="add" onclick="showSubTab('clothing', 'add', this)">â•</button>
      </div>

      <div id="clothing-dong" class="sub-tab-content active"></div>
      <div id="clothing-olivia" class="sub-tab-content"></div>
      <div id="clothing-bedding" class="sub-tab-content"></div>
      <div id="clothing-shoes" class="sub-tab-content"></div>
      <div id="clothing-add" class="sub-tab-content"></div>
    </div>

    <!-- è¿åŠ¨è£…å¤‡è§†å›¾ -->
    <div id="sportsView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸƒ è¿åŠ¨è£…å¤‡</h2>
      
      <div class="tabs" id="sportsTabs">
        <button class="tab active" data-tab="running" onclick="showSubTab('sports', 'running', this)">ğŸƒ è·‘æ­¥</button>
        <button class="tab" data-tab="gym" onclick="showSubTab('sports', 'gym', this)">ğŸ‹ï¸ å¥èº«</button>
        <button class="tab" data-tab="tennis" onclick="showSubTab('sports', 'tennis', this)">ğŸ¾ ç½‘çƒ</button>
        <button class="tab" data-tab="football" onclick="showSubTab('sports', 'football', this)">âš½ è¶³çƒ</button>
        <button class="tab" data-tab="ski" onclick="showSubTab('sports', 'ski', this)">ğŸ¿ æ»‘é›ª</button>
        <button class="tab" data-tab="add" onclick="showSubTab('sports', 'add', this)">â•</button>
      </div>

      <div id="sports-running" class="sub-tab-content active"></div>
      <div id="sports-gym" class="sub-tab-content"></div>
      <div id="sports-tennis" class="sub-tab-content"></div>
      <div id="sports-football" class="sub-tab-content"></div>
      <div id="sports-ski" class="sub-tab-content"></div>
      <div id="sports-add" class="sub-tab-content"></div>
    </div>

    <!-- ç”µå­äº§å“è§†å›¾ -->
    <div id="electronicsView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ“± ç”µå­äº§å“</h2>
      
      <div class="tabs" id="electronicsTabs">
        <button class="tab active" data-tab="apple" onclick="showSubTab('electronics', 'apple', this)">ğŸ Apple</button>
        <button class="tab" data-tab="computer" onclick="showSubTab('electronics', 'computer', this)">ğŸ’» ç”µè„‘</button>
        <button class="tab" data-tab="home" onclick="showSubTab('electronics', 'home', this)">ğŸ  æ™ºèƒ½å®¶å±…</button>
        <button class="tab" data-tab="accessories" onclick="showSubTab('electronics', 'accessories', this)">ğŸ”Œ é…ä»¶</button>
        <button class="tab" data-tab="add" onclick="showSubTab('electronics', 'add', this)">â•</button>
      </div>

      <div id="electronics-apple" class="sub-tab-content active"></div>
      <div id="electronics-computer" class="sub-tab-content"></div>
      <div id="electronics-home" class="sub-tab-content"></div>
      <div id="electronics-accessories" class="sub-tab-content"></div>
      <div id="electronics-add" class="sub-tab-content"></div>
    </div>

    <!-- è¿åŠ¨è¡¥ç»™è§†å›¾ -->
    <div id="supplementsView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">âš¡ è¿åŠ¨è¡¥ç»™</h2>
      
      <div class="tabs" id="supplementsTabs">
        <button class="tab active" data-tab="energy" onclick="showSubTab('supplements', 'energy', this)">âš¡ èƒ½é‡èƒ¶</button>
        <button class="tab" data-tab="electrolyte" onclick="showSubTab('supplements', 'electrolyte', this)">ğŸ’Š ç”µè§£è´¨</button>
        <button class="tab" data-tab="protein" onclick="showSubTab('supplements', 'protein', this)">ğŸ¥¤ è›‹ç™½</button>
        <button class="tab" data-tab="hydration" onclick="showSubTab('supplements', 'hydration', this)">ğŸ§ƒ é¥®æ–™</button>
        <button class="tab" data-tab="add" onclick="showSubTab('supplements', 'add', this)">â•</button>
      </div>

      <div id="supplements-energy" class="sub-tab-content active"></div>
      <div id="supplements-electrolyte" class="sub-tab-content"></div>
      <div id="supplements-protein" class="sub-tab-content"></div>
      <div id="supplements-hydration" class="sub-tab-content"></div>
      <div id="supplements-add" class="sub-tab-content"></div>
    </div>

    <!-- é‡‡ä¹°æ¸…å•è§†å›¾ -->
    <div id="shoppingView" class="category-view">
      <button class="back-btn show" onclick="goBack()">â† è¿”å›</button>
      <h2 style="font-size: 18px; margin-bottom: 16px;">ğŸ›’ é‡‡ä¹°æ¸…å•</h2>
      
      <!-- ä¸´æ—¶æ·»åŠ ç‰©å“ -->
      <div class="section" style="margin-bottom: 12px;">
        <div class="section-title">âœï¸ ä¸´æ—¶æ·»åŠ </div>
        <div style="display: flex; gap: 8px;">
          <input type="text" class="form-input" id="quickAddItem" placeholder="æƒ³ä¹°çš„ä¸œè¥¿..." style="flex: 1; color: #eaeaea; background: #0f172a; -webkit-text-fill-color: #eaeaea; opacity: 1;">
          <button class="btn btn-primary" style="padding: 10px 16px;" onclick="addQuickItem()">+</button>
        </div>
        <div id="quickItemsList" style="margin-top: 10px;"></div>
      </div>
      
      <button class="btn btn-warning btn-large" onclick="generateShoppingList()">
        ğŸ›’ ç”Ÿæˆé‡‡ä¹°æ¸…å•
      </button>
      
      <div id="appleExportSection" style="display: none; margin-bottom: 12px;">
        <button class="btn btn-large" style="background: linear-gradient(135deg, #FF6B6B, #FF8E53); width: 100%;" onclick="syncToApple()">
          ğŸ åŒæ­¥åˆ° Apple Reminders + æ—¥å†
        </button>
        <p style="font-size: 11px; color: var(--muted); text-align: center; margin-top: 8px;">
          ä»…åŒ…å«æ—¥ç”¨å“å’Œé£Ÿæ
        </p>
      </div>
      
      <div class="section">
        <div class="section-title">
          <span>ğŸ“ éœ€è¦è´­ä¹°</span>
          <span class="section-badge" id="shoppingCount">0</span>
        </div>
        <div id="shoppingList" style="max-height: none; overflow: visible;"></div>
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn btn-success" style="flex: 1;" onclick="markAllBought()">âœ… å…¨éƒ¨ä¹°é½</button>
        <button class="btn btn-secondary" style="flex: 1;" onclick="clearChecked()">ğŸ”„ æ¸…é™¤æ ‡è®°</button>
      </div>
    </div>
  </div>

  <!-- ç¼–è¾‘å¼¹çª— -->
  <div class="edit-modal hidden" id="editModal">
    <div class="edit-modal-content">
      <h3>âœï¸ ç¼–è¾‘ç‰©å“</h3>
      <input type="hidden" id="editId">
      <input type="hidden" id="editMainCat">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ç‰©å“åç§°</label>
          <input type="text" class="form-input" id="editName">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group small">
          <label class="form-label">æ•°é‡</label>
          <input type="number" class="form-input" id="editQty" min="0">
        </div>
        <div class="form-group small">
          <label class="form-label">å»ºè®®å­˜é‡</label>
          <input type="number" class="form-input" id="editSuggest" min="0">
        </div>
      </div>
      <div class="form-row" id="editExpiryRow">
        <div class="form-group">
          <label class="form-label">ä¿è´¨æœŸ</label>
          <input type="date" class="form-input" id="editExpiry">
        </div>
      </div>
      <div class="form-row" id="editSeasonRow">
        <div class="form-group">
          <label class="form-label">å­£èŠ‚</label>
          <select class="form-select" id="editSeason">
            <option value="all">å››å­£é€šç”¨</option>
            <option value="spring">æ˜¥å­£</option>
            <option value="summer">å¤å­£</option>
            <option value="autumn">ç§‹å­£</option>
            <option value="winter">å†¬å­£</option>
          </select>
        </div>
      </div>
      <div class="form-row" id="editConditionRow">
        <div class="form-group">
          <label class="form-label">çŠ¶æ€</label>
          <select class="form-select" id="editCondition">
            <option value="good">è‰¯å¥½</option>
            <option value="fair">ä¸€èˆ¬</option>
            <option value="worn">ç£¨æŸ</option>
            <option value="replace">éœ€æ›´æ¢</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">å¤‡æ³¨</label>
          <input type="text" class="form-input" id="editNotes" placeholder="å¯é€‰">
        </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 16px;">
        <button class="btn btn-secondary" style="flex: 1;" onclick="closeEditModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" style="flex: 1;" onclick="saveEdit()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ========== æ•°æ®ç»“æ„ ==========
    const MAIN_CATEGORIES = {
      daily: {
        name: 'æ—¥ç”¨å“',
        icon: 'ğŸ§´',
        subCategories: {
          medicine: { name: 'è¯å“', icon: 'ğŸ’Š' },
          hygiene: { name: 'å«ç”Ÿ', icon: 'ğŸ§´' },
          cleaning: { name: 'æ¸…æ´', icon: 'ğŸ§¹' },
          kitchen: { name: 'å¨æˆ¿', icon: 'ğŸ³' },
          other: { name: 'å…¶ä»–', icon: 'ğŸ“¦' }
        }
      },
      food: {
        name: 'é£Ÿæ',
        icon: 'ğŸ¥¬',
        subCategories: {
          fridge: { name: 'å†°ç®±', icon: 'ğŸ§Š' },
          freezer: { name: 'å†·å†»', icon: 'â„ï¸' },
          pantry: { name: 'å‚¨ç‰©æŸœ', icon: 'ğŸ¥«' },
          spices: { name: 'è°ƒæ–™', icon: 'ğŸ§‚' },
          drinks: { name: 'é¥®å“', icon: 'ğŸ·' },
          fitness: { name: 'å¥èº«é£Ÿæ', icon: 'ğŸ’ª' }
        }
      },
      clothing: {
        name: 'è¡£ç‰©',
        icon: 'ğŸ‘”',
        subCategories: {
          dong: { name: 'Dong', icon: 'ğŸ‘”' },
          olivia: { name: 'Olivia', icon: 'ğŸ‘—' },
          bedding: { name: 'åºŠå“', icon: 'ğŸ›ï¸' },
          shoes: { name: 'é‹å­', icon: 'ğŸ‘Ÿ' }
        }
      },
      sports: {
        name: 'è¿åŠ¨è£…å¤‡',
        icon: 'ğŸƒ',
        subCategories: {
          running: { name: 'è·‘æ­¥', icon: 'ğŸƒ' },
          gym: { name: 'å¥èº«', icon: 'ğŸ‹ï¸' },
          tennis: { name: 'ç½‘çƒ', icon: 'ğŸ¾' },
          football: { name: 'è¶³çƒ', icon: 'âš½' },
          ski: { name: 'æ»‘é›ª', icon: 'ğŸ¿' }
        }
      },
      electronics: {
        name: 'ç”µå­',
        icon: 'ğŸ“±',
        subCategories: {
          apple: { name: 'Apple', icon: 'ğŸ' },
          computer: { name: 'ç”µè„‘', icon: 'ğŸ’»' },
          home: { name: 'æ™ºèƒ½å®¶å±…', icon: 'ğŸ ' },
          accessories: { name: 'é…ä»¶', icon: 'ğŸ”Œ' }
        }
      },
      supplements: {
        name: 'è¿åŠ¨è¡¥ç»™',
        icon: 'âš¡',
        subCategories: {
          energy: { name: 'èƒ½é‡èƒ¶', icon: 'âš¡' },
          electrolyte: { name: 'ç”µè§£è´¨', icon: 'ğŸ’Š' },
          protein: { name: 'è›‹ç™½/å¢è‚Œ', icon: 'ğŸ¥¤' },
          hydration: { name: 'è¿åŠ¨é¥®æ–™', icon: 'ğŸ§ƒ' }
        }
      }
    };

    // é»˜è®¤æ•°æ®
    const DEFAULT_DATA = {
      daily: [
        // è¯å“
        { name: 'Panadol æ­¢ç—›ç‰‡', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ’Š' },
        { name: 'Nurofen å¸ƒæ´›èŠ¬', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ’Š' },
        { name: 'æ„Ÿå†’è¯ (Codral)', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ¤§' },
        { name: 'åˆ›å¯è´´', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ©¹' },
        { name: 'Dettol æ¶ˆæ¯’æ¶²', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸ§´' },
        { name: 'çƒ«ä¼¤è† (Burnaid)', subCat: 'medicine', qty: 0, suggest: 1, unit: 'æ”¯', location: 'è¯ç®±', icon: 'ğŸ”¥' },
        { name: 'æ­¢æ³»è¯ (Imodium)', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ’Š' },
        { name: 'æŠ—è¿‡æ•è¯ (Zyrtec)', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸŒ¸' },
        { name: 'çœ¼è¯æ°´', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸ‘ï¸' },
        { name: 'ä½“æ¸©è®¡', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ä¸ª', location: 'è¯ç®±', icon: 'ğŸŒ¡ï¸' },
        { name: 'ç»´ç”Ÿç´ C', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸŠ' },
        { name: 'ç»´ç”Ÿç´ D', subCat: 'medicine', qty: 0, suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'â˜€ï¸' },
        
        // å«ç”Ÿ
        { name: 'ç‰™è†', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸ¦·' },
        { name: 'ç‰™åˆ·', subCat: 'hygiene', qty: 0, suggest: 4, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸª¥' },
        { name: 'ç‰™çº¿', subCat: 'hygiene', qty: 0, suggest: 1, unit: 'ç›’', location: 'æµ´å®¤æŸœ', icon: 'ğŸ¦·' },
        { name: 'æ´—å‘æ°´', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
        { name: 'æŠ¤å‘ç´ ', subCat: 'hygiene', qty: 0, suggest: 1, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
        { name: 'æ²æµ´éœ²', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§¼' },
        { name: 'æ´—é¢å¥¶', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
        { name: 'é¢éœœ/ä¹³æ¶²', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
        { name: 'é˜²æ™’éœœ', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'â˜€ï¸' },
        { name: 'å«ç”Ÿçº¸', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'åŒ…', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§»' },
        { name: 'é¢å·¾çº¸', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'ç›’', location: 'å®¢å…', icon: 'ğŸ§»' },
        { name: 'æ£‰ç­¾', subCat: 'hygiene', qty: 0, suggest: 1, unit: 'ç›’', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§µ' },
        { name: 'é™¤è‡­å‰‚', subCat: 'hygiene', qty: 0, suggest: 2, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
        
        // æ¸…æ´
        { name: 'æ´—è¡£æ¶²', subCat: 'cleaning', qty: 0, suggest: 2, unit: 'ç“¶', location: 'æ´—è¡£æˆ¿', icon: 'ğŸ§º' },
        { name: 'æŸ”é¡ºå‰‚', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'ç“¶', location: 'æ´—è¡£æˆ¿', icon: 'ğŸŒ¸' },
        { name: 'æ´—æ´ç²¾', subCat: 'cleaning', qty: 0, suggest: 2, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ§´' },
        { name: 'å¤šåŠŸèƒ½æ¸…æ´å‰‚', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å‚¨ç‰©é—´', icon: 'ğŸ§¹' },
        { name: 'ç»ç’ƒæ¸…æ´å‰‚', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å‚¨ç‰©é—´', icon: 'ğŸªŸ' },
        { name: 'é©¬æ¡¶æ¸…æ´å‰‚', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸš½' },
        { name: 'æ¶ˆæ¯’æ¹¿å·¾', subCat: 'cleaning', qty: 0, suggest: 2, unit: 'åŒ…', location: 'å‚¨ç‰©é—´', icon: 'ğŸ§»' },
        { name: 'æµ·ç»µ/ç™¾æ´å¸ƒ', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å¨æˆ¿', icon: 'ğŸ§½' },
        { name: 'åƒåœ¾è¢‹ (å¤§)', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'å·', location: 'å‚¨ç‰©é—´', icon: 'ğŸ—‘ï¸' },
        { name: 'åƒåœ¾è¢‹ (å°)', subCat: 'cleaning', qty: 0, suggest: 1, unit: 'å·', location: 'å‚¨ç‰©é—´', icon: 'ğŸ—‘ï¸' },
        
        // å¨æˆ¿
        { name: 'ä¿é²œè†œ', subCat: 'kitchen', qty: 0, suggest: 2, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸï¸' },
        { name: 'é”¡ç®”çº¸', subCat: 'kitchen', qty: 0, suggest: 1, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸª©' },
        { name: 'çƒ˜ç„™çº¸', subCat: 'kitchen', qty: 0, suggest: 1, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸ“œ' },
        { name: 'å¨æˆ¿çº¸å·¾', subCat: 'kitchen', qty: 0, suggest: 2, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸ§»' },
        { name: 'æ´—ç¢—æµ·ç»µ', subCat: 'kitchen', qty: 0, suggest: 3, unit: 'ä¸ª', location: 'å¨æˆ¿', icon: 'ğŸ§½' },
        { name: 'ä¿é²œè¢‹', subCat: 'kitchen', qty: 0, suggest: 1, unit: 'ç›’', location: 'å¨æˆ¿', icon: 'ğŸ‘œ' },
        
        // å…¶ä»–
        { name: 'ç”µæ±  (AA)', subCat: 'other', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©é—´', icon: 'ğŸ”‹' },
        { name: 'ç”µæ±  (AAA)', subCat: 'other', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©é—´', icon: 'ğŸ”‹' },
        { name: 'ç¯æ³¡', subCat: 'other', qty: 0, suggest: 2, unit: 'ä¸ª', location: 'å‚¨ç‰©é—´', icon: 'ğŸ’¡' },
        { name: 'é›¨ä¼', subCat: 'other', qty: 0, suggest: 2, unit: 'æŠŠ', location: 'ç„å…³', icon: 'â˜”' },
      ],
      food: [
        // å†°ç®±
        { name: 'é¸¡è›‹', subCat: 'fridge', qty: 0, suggest: 12, unit: 'ä¸ª', location: 'å†°ç®±', icon: 'ğŸ¥š' },
        { name: 'ç‰›å¥¶', subCat: 'fridge', qty: 0, suggest: 2, unit: 'å‡', location: 'å†°ç®±', icon: 'ğŸ¥›' },
        { name: 'é…¸å¥¶', subCat: 'fridge', qty: 0, suggest: 4, unit: 'ç›’', location: 'å†°ç®±', icon: 'ğŸ¥›' },
        { name: 'é»„æ²¹', subCat: 'fridge', qty: 0, suggest: 1, unit: 'å—', location: 'å†°ç®±', icon: 'ğŸ§ˆ' },
        { name: 'èŠå£«', subCat: 'fridge', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å†°ç®±', icon: 'ğŸ§€' },
        { name: 'è±†è…', subCat: 'fridge', qty: 0, suggest: 2, unit: 'ç›’', location: 'å†°ç®±', icon: 'ğŸ¥¡' },
        { name: 'è”¬èœ (å¶èœ)', subCat: 'fridge', qty: 0, suggest: 3, unit: 'æŠŠ', location: 'å†°ç®±', icon: 'ğŸ¥¬' },
        { name: 'èƒ¡èåœ', subCat: 'fridge', qty: 0, suggest: 5, unit: 'æ ¹', location: 'å†°ç®±', icon: 'ğŸ¥•' },
        { name: 'è¥¿çº¢æŸ¿', subCat: 'fridge', qty: 0, suggest: 4, unit: 'ä¸ª', location: 'å†°ç®±', icon: 'ğŸ…' },
        { name: 'æ´‹è‘±', subCat: 'fridge', qty: 0, suggest: 3, unit: 'ä¸ª', location: 'å†°ç®±', icon: 'ğŸ§…' },
        
        // å†·å†»
        { name: 'å†·å†»è‚‰ç±»', subCat: 'freezer', qty: 0, suggest: 3, unit: 'åŒ…', location: 'å†·å†»', icon: 'ğŸ¥©' },
        { name: 'å†·å†»è™¾', subCat: 'freezer', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å†·å†»', icon: 'ğŸ¦' },
        { name: 'å†·å†»é±¼', subCat: 'freezer', qty: 0, suggest: 2, unit: 'åŒ…', location: 'å†·å†»', icon: 'ğŸŸ' },
        { name: 'é€Ÿå†»æ°´é¥º', subCat: 'freezer', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å†·å†»', icon: 'ğŸ¥Ÿ' },
        { name: 'å†°æ·‡æ·‹', subCat: 'freezer', qty: 0, suggest: 1, unit: 'ç›’', location: 'å†·å†»', icon: 'ğŸ¨' },
        { name: 'å†·å†»è”¬èœ', subCat: 'freezer', qty: 0, suggest: 2, unit: 'åŒ…', location: 'å†·å†»', icon: 'ğŸ¥¦' },
        
        // å‚¨ç‰©æŸœ
        { name: 'å¤§ç±³', subCat: 'pantry', qty: 0, suggest: 5, unit: 'å…¬æ–¤', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸš' },
        { name: 'é¢æ¡/æ„é¢', subCat: 'pantry', qty: 0, suggest: 3, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ' },
        { name: 'é¢ç²‰', subCat: 'pantry', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸŒ¾' },
        { name: 'ç‡•éº¦ç‰‡', subCat: 'pantry', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ¥£' },
        { name: 'ç½å¤´ (å„ç±»)', subCat: 'pantry', qty: 0, suggest: 5, unit: 'ç½', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ¥«' },
        { name: 'åšæœ', subCat: 'pantry', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ¥œ' },
        { name: 'é›¶é£Ÿ', subCat: 'pantry', qty: 0, suggest: 3, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸª' },
        
        // è°ƒæ–™
        { name: 'ç›', subCat: 'spices', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å¨æˆ¿', icon: 'ğŸ§‚' },
        { name: 'ç³–', subCat: 'spices', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å¨æˆ¿', icon: 'ğŸ¬' },
        { name: 'é…±æ²¹', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ«—' },
        { name: 'é†‹', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ«—' },
        { name: 'æ–™é…’', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ¶' },
        { name: 'èšæ²¹', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ«—' },
        { name: 'ç•ªèŒ„é…±', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ…' },
        { name: 'è¾£æ¤’é…±', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸŒ¶ï¸' },
        { name: 'é£Ÿç”¨æ²¹', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ«’' },
        { name: 'æ©„æ¦„æ²¹', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ«’' },
        { name: 'èœ‚èœœ', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ¯' },
        { name: 'èƒ¡æ¤’ç²‰', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ§‚' },
        { name: 'äº”é¦™ç²‰', subCat: 'spices', qty: 0, suggest: 1, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ§‚' },
        
        // é¥®å“
        { name: 'çŸ¿æ³‰æ°´', subCat: 'drinks', qty: 0, suggest: 6, unit: 'ç“¶', location: 'å‚¨ç‰©é—´', icon: 'ğŸ’§' },
        { name: 'å’–å•¡è±†/ç²‰', subCat: 'drinks', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å¨æˆ¿', icon: 'â˜•' },
        { name: 'èŒ¶å¶', subCat: 'drinks', qty: 0, suggest: 1, unit: 'ç›’', location: 'å¨æˆ¿', icon: 'ğŸµ' },
        { name: 'æœæ±', subCat: 'drinks', qty: 0, suggest: 2, unit: 'ç“¶', location: 'å†°ç®±', icon: 'ğŸ§ƒ' },
        { name: 'çº¢é…’', subCat: 'drinks', qty: 0, suggest: 2, unit: 'ç“¶', location: 'å‚¨ç‰©é—´', icon: 'ğŸ·' },
        { name: 'å•¤é…’', subCat: 'drinks', qty: 0, suggest: 6, unit: 'ç½', location: 'å†°ç®±', icon: 'ğŸº' },
        
        // å¥èº«é£Ÿæ
        { name: 'è›‹ç™½ç²‰', subCat: 'fitness', qty: 0, suggest: 1, unit: 'ç½', location: 'å¨æˆ¿', icon: 'ğŸ’ª' },
        { name: 'é¸¡èƒ¸è‚‰', subCat: 'fitness', qty: 0, suggest: 1, unit: 'å…¬æ–¤', location: 'å†·å†»', icon: 'ğŸ—' },
        { name: 'å¸Œè…Šé…¸å¥¶', subCat: 'fitness', qty: 0, suggest: 4, unit: 'ç›’', location: 'å†°ç®±', icon: 'ğŸ¥›' },
        { name: 'ç‰›æ²¹æœ', subCat: 'fitness', qty: 0, suggest: 3, unit: 'ä¸ª', location: 'å†°ç®±', icon: 'ğŸ¥‘' },
        { name: 'ä¸‰æ–‡é±¼', subCat: 'fitness', qty: 0, suggest: 2, unit: 'å—', location: 'å†·å†»', icon: 'ğŸŸ' },
        { name: 'ç‡•éº¦', subCat: 'fitness', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ¥£' },
        { name: 'é¦™è•‰', subCat: 'fitness', qty: 0, suggest: 6, unit: 'æ ¹', location: 'å¨æˆ¿', icon: 'ğŸŒ' },
        { name: 'æä»/åšæœ', subCat: 'fitness', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ¥œ' },
        { name: 'è¥¿å…°èŠ±', subCat: 'fitness', qty: 0, suggest: 2, unit: 'ä¸ª', location: 'å†°ç®±', icon: 'ğŸ¥¦' },
        { name: 'ç³™ç±³', subCat: 'fitness', qty: 0, suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸš' },
        { name: 'èƒ½é‡æ£’', subCat: 'fitness', qty: 0, suggest: 6, unit: 'æ¡', location: 'å‚¨ç‰©æŸœ', icon: 'ğŸ«' },
        { name: 'BCAA/æ°¨åŸºé…¸', subCat: 'fitness', qty: 0, suggest: 1, unit: 'ç½', location: 'å¨æˆ¿', icon: 'ğŸ’Š' },
      ],
      clothing: [
        // Dong
        { name: 'Tæ¤', subCat: 'dong', qty: 0, suggest: 0, unit: 'ä»¶', season: 'summer', condition: 'good', icon: 'ğŸ‘•' },
        { name: 'è¡¬è¡«', subCat: 'dong', qty: 0, suggest: 0, unit: 'ä»¶', season: 'all', condition: 'good', icon: 'ğŸ‘”' },
        { name: 'ç‰›ä»”è£¤', subCat: 'dong', qty: 0, suggest: 0, unit: 'æ¡', season: 'all', condition: 'good', icon: 'ğŸ‘–' },
        { name: 'çŸ­è£¤', subCat: 'dong', qty: 0, suggest: 0, unit: 'æ¡', season: 'summer', condition: 'good', icon: 'ğŸ©³' },
        { name: 'è¥¿è£…å¤–å¥—', subCat: 'dong', qty: 0, suggest: 0, unit: 'ä»¶', season: 'all', condition: 'good', icon: 'ğŸ§¥' },
        { name: 'ç¾½ç»’æœ', subCat: 'dong', qty: 0, suggest: 0, unit: 'ä»¶', season: 'winter', condition: 'good', icon: 'ğŸ§¥' },
        { name: 'æ¯›è¡£', subCat: 'dong', qty: 0, suggest: 0, unit: 'ä»¶', season: 'winter', condition: 'good', icon: 'ğŸ§¶' },
        { name: 'å¤¹å…‹', subCat: 'dong', qty: 0, suggest: 0, unit: 'ä»¶', season: 'autumn', condition: 'good', icon: 'ğŸ§¥' },
        { name: 'è¿åŠ¨è£¤', subCat: 'dong', qty: 0, suggest: 0, unit: 'æ¡', season: 'all', condition: 'good', icon: 'ğŸ‘–' },
        { name: 'ç¡è¡£', subCat: 'dong', qty: 0, suggest: 0, unit: 'å¥—', season: 'all', condition: 'good', icon: 'ğŸ©²' },
        { name: 'å†…è£¤', subCat: 'dong', qty: 0, suggest: 10, unit: 'æ¡', season: 'all', condition: 'good', icon: 'ğŸ©²' },
        { name: 'è¢œå­', subCat: 'dong', qty: 0, suggest: 10, unit: 'åŒ', season: 'all', condition: 'good', icon: 'ğŸ§¦' },
        
        // Olivia
        { name: 'Tæ¤', subCat: 'olivia', qty: 0, suggest: 0, unit: 'ä»¶', season: 'summer', condition: 'good', icon: 'ğŸ‘š' },
        { name: 'è¿è¡£è£™', subCat: 'olivia', qty: 0, suggest: 0, unit: 'ä»¶', season: 'summer', condition: 'good', icon: 'ğŸ‘—' },
        { name: 'è¡¬è¡«', subCat: 'olivia', qty: 0, suggest: 0, unit: 'ä»¶', season: 'all', condition: 'good', icon: 'ğŸ‘š' },
        { name: 'ç‰›ä»”è£¤', subCat: 'olivia', qty: 0, suggest: 0, unit: 'æ¡', season: 'all', condition: 'good', icon: 'ğŸ‘–' },
        { name: 'è£™å­', subCat: 'olivia', qty: 0, suggest: 0, unit: 'æ¡', season: 'summer', condition: 'good', icon: 'ğŸ‘—' },
        { name: 'å¤§è¡£', subCat: 'olivia', qty: 0, suggest: 0, unit: 'ä»¶', season: 'winter', condition: 'good', icon: 'ğŸ§¥' },
        { name: 'ç¾½ç»’æœ', subCat: 'olivia', qty: 0, suggest: 0, unit: 'ä»¶', season: 'winter', condition: 'good', icon: 'ğŸ§¥' },
        { name: 'æ¯›è¡£', subCat: 'olivia', qty: 0, suggest: 0, unit: 'ä»¶', season: 'winter', condition: 'good', icon: 'ğŸ§¶' },
        { name: 'ç¡è¡£', subCat: 'olivia', qty: 0, suggest: 0, unit: 'å¥—', season: 'all', condition: 'good', icon: 'ğŸ‘š' },
        
        // åºŠå“
        { name: 'åºŠå•', subCat: 'bedding', qty: 0, suggest: 2, unit: 'å¥—', season: 'all', condition: 'good', icon: 'ğŸ›ï¸' },
        { name: 'è¢«å¥—', subCat: 'bedding', qty: 0, suggest: 2, unit: 'å¥—', season: 'all', condition: 'good', icon: 'ğŸ›ï¸' },
        { name: 'æ•å¥—', subCat: 'bedding', qty: 0, suggest: 4, unit: 'ä¸ª', season: 'all', condition: 'good', icon: 'ğŸ›ï¸' },
        { name: 'å¤å‡‰è¢«', subCat: 'bedding', qty: 0, suggest: 1, unit: 'åºŠ', season: 'summer', condition: 'good', icon: 'ğŸ›ï¸' },
        { name: 'å†¬è¢«', subCat: 'bedding', qty: 0, suggest: 1, unit: 'åºŠ', season: 'winter', condition: 'good', icon: 'ğŸ›ï¸' },
        { name: 'æ¯›æ¯¯', subCat: 'bedding', qty: 0, suggest: 2, unit: 'æ¡', season: 'winter', condition: 'good', icon: 'ğŸ§¶' },
        { name: 'æ•å¤´', subCat: 'bedding', qty: 0, suggest: 4, unit: 'ä¸ª', season: 'all', condition: 'good', icon: 'ğŸ›ï¸' },
        { name: 'æµ´å·¾', subCat: 'bedding', qty: 0, suggest: 4, unit: 'æ¡', season: 'all', condition: 'good', icon: 'ğŸ›' },
        { name: 'æ¯›å·¾', subCat: 'bedding', qty: 0, suggest: 6, unit: 'æ¡', season: 'all', condition: 'good', icon: 'ğŸ§´' },
        
        // é‹å­
        { name: 'çš®é‹ (Dong)', subCat: 'shoes', qty: 0, suggest: 0, unit: 'åŒ', season: 'all', condition: 'good', icon: 'ğŸ‘' },
        { name: 'è¿åŠ¨é‹ (Dong)', subCat: 'shoes', qty: 0, suggest: 0, unit: 'åŒ', season: 'all', condition: 'good', icon: 'ğŸ‘Ÿ' },
        { name: 'æ‹–é‹ (Dong)', subCat: 'shoes', qty: 0, suggest: 1, unit: 'åŒ', season: 'all', condition: 'good', icon: 'ğŸ©´' },
        { name: 'é«˜è·Ÿé‹ (Olivia)', subCat: 'shoes', qty: 0, suggest: 0, unit: 'åŒ', season: 'all', condition: 'good', icon: 'ğŸ‘ ' },
        { name: 'è¿åŠ¨é‹ (Olivia)', subCat: 'shoes', qty: 0, suggest: 0, unit: 'åŒ', season: 'all', condition: 'good', icon: 'ğŸ‘Ÿ' },
        { name: 'å‡‰é‹', subCat: 'shoes', qty: 0, suggest: 0, unit: 'åŒ', season: 'summer', condition: 'good', icon: 'ğŸ‘¡' },
        { name: 'é´å­', subCat: 'shoes', qty: 0, suggest: 0, unit: 'åŒ', season: 'winter', condition: 'good', icon: 'ğŸ‘¢' },
      ],
      sports: [
        // è·‘æ­¥
        { name: 'è·‘æ­¥é‹', subCat: 'running', qty: 0, suggest: 2, unit: 'åŒ', condition: 'good', icon: 'ğŸ‘Ÿ' },
        { name: 'è·‘æ­¥è£¤', subCat: 'running', qty: 0, suggest: 3, unit: 'æ¡', condition: 'good', icon: 'ğŸ©³' },
        { name: 'è·‘æ­¥Tæ¤', subCat: 'running', qty: 0, suggest: 4, unit: 'ä»¶', condition: 'good', icon: 'ğŸ‘•' },
        { name: 'è¿åŠ¨è¢œ', subCat: 'running', qty: 0, suggest: 5, unit: 'åŒ', condition: 'good', icon: 'ğŸ§¦' },
        { name: 'è·‘æ­¥è…°åŒ…', subCat: 'running', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ‘œ' },
        { name: 'è¿åŠ¨è€³æœº', subCat: 'running', qty: 0, suggest: 1, unit: 'å‰¯', condition: 'good', icon: 'ğŸ§' },
        { name: 'è¿åŠ¨æ‰‹è¡¨', subCat: 'running', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'âŒš' },
        { name: 'åå…‰èƒŒå¿ƒ', subCat: 'running', qty: 0, suggest: 1, unit: 'ä»¶', condition: 'good', icon: 'ğŸ¦º' },
        
        // å¥èº«
        { name: 'è®­ç»ƒé‹', subCat: 'gym', qty: 0, suggest: 1, unit: 'åŒ', condition: 'good', icon: 'ğŸ‘Ÿ' },
        { name: 'å¥èº«æ‰‹å¥—', subCat: 'gym', qty: 0, suggest: 1, unit: 'åŒ', condition: 'good', icon: 'ğŸ§¤' },
        { name: 'è¿åŠ¨æ°´å£¶', subCat: 'gym', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ¼' },
        { name: 'ç‘œä¼½å«', subCat: 'gym', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ§˜' },
        { name: 'æ³¡æ²«è½´', subCat: 'gym', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ‹ï¸' },
        { name: 'é˜»åŠ›å¸¦', subCat: 'gym', qty: 0, suggest: 1, unit: 'å¥—', condition: 'good', icon: 'ğŸ‹ï¸' },
        { name: 'æŠ¤è…•', subCat: 'gym', qty: 0, suggest: 1, unit: 'åŒ', condition: 'good', icon: 'ğŸ‹ï¸' },
        
        // ç½‘çƒ
        { name: 'ç½‘çƒæ‹', subCat: 'tennis', qty: 0, suggest: 1, unit: 'æŠŠ', condition: 'good', icon: 'ğŸ¾' },
        { name: 'ç½‘çƒ', subCat: 'tennis', qty: 0, suggest: 6, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ¾' },
        { name: 'ç½‘çƒé‹', subCat: 'tennis', qty: 0, suggest: 1, unit: 'åŒ', condition: 'good', icon: 'ğŸ‘Ÿ' },
        { name: 'ç½‘çƒåŒ…', subCat: 'tennis', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ’' },
        { name: 'æŠ¤è…•å¸¦', subCat: 'tennis', qty: 0, suggest: 2, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ¾' },
        { name: 'æ‰‹èƒ¶', subCat: 'tennis', qty: 0, suggest: 3, unit: 'æ¡', condition: 'good', icon: 'ğŸ¾' },
        
        // è¶³çƒ
        { name: 'è¶³çƒé‹', subCat: 'football', qty: 0, suggest: 1, unit: 'åŒ', condition: 'good', icon: 'âš½' },
        { name: 'è¶³çƒ', subCat: 'football', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'âš½' },
        { name: 'æŠ¤è…¿æ¿', subCat: 'football', qty: 0, suggest: 1, unit: 'åŒ', condition: 'good', icon: 'âš½' },
        { name: 'è¶³çƒè¢œ', subCat: 'football', qty: 0, suggest: 2, unit: 'åŒ', condition: 'good', icon: 'ğŸ§¦' },
        
        // æ»‘é›ª
        { name: 'æ»‘é›ªæœ (å¤–å¥—)', subCat: 'ski', qty: 0, suggest: 0, unit: 'ä»¶', condition: 'good', icon: 'ğŸ§¥' },
        { name: 'æ»‘é›ªè£¤', subCat: 'ski', qty: 0, suggest: 0, unit: 'æ¡', condition: 'good', icon: 'ğŸ‘–' },
        { name: 'æ»‘é›ªæ‰‹å¥—', subCat: 'ski', qty: 0, suggest: 0, unit: 'åŒ', condition: 'good', icon: 'ğŸ§¤' },
        { name: 'æ»‘é›ªæŠ¤ç›®é•œ', subCat: 'ski', qty: 0, suggest: 0, unit: 'å‰¯', condition: 'good', icon: 'ğŸ¥½' },
        { name: 'æ»‘é›ªå¤´ç›”', subCat: 'ski', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'â›‘ï¸' },
        { name: 'æ»‘é›ªè¢œ', subCat: 'ski', qty: 0, suggest: 2, unit: 'åŒ', condition: 'good', icon: 'ğŸ§¦' },
        { name: 'ä¿æš–å†…è¡£', subCat: 'ski', qty: 0, suggest: 0, unit: 'å¥—', condition: 'good', icon: 'ğŸ§£' },
        { name: 'æŠ¤è„¸é¢ç½©', subCat: 'ski', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ¿' },
      ],
      electronics: [
        // Apple
        { name: 'iPhone', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', purchaseDate: '', warranty: '', icon: 'ğŸ“±' },
        { name: 'iPad', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ“±' },
        { name: 'MacBook', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ’»' },
        { name: 'Mac mini', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ–¥ï¸' },
        { name: 'Apple Watch', subCat: 'apple', qty: 0, suggest: 0, unit: 'å—', condition: 'good', icon: 'âŒš' },
        { name: 'AirPods', subCat: 'apple', qty: 0, suggest: 0, unit: 'å‰¯', condition: 'good', icon: 'ğŸ§' },
        { name: 'AirPods Max', subCat: 'apple', qty: 0, suggest: 0, unit: 'å‰¯', condition: 'good', icon: 'ğŸ§' },
        { name: 'Apple TV', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ“º' },
        { name: 'HomePod', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ”Š' },
        { name: 'HomePod mini', subCat: 'apple', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ”Š' },
        
        // ç”µè„‘é…ä»¶
        { name: 'æ˜¾ç¤ºå™¨', subCat: 'computer', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ–¥ï¸' },
        { name: 'é”®ç›˜', subCat: 'computer', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'âŒ¨ï¸' },
        { name: 'é¼ æ ‡', subCat: 'computer', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ–±ï¸' },
        { name: 'è§¦æ§æ¿', subCat: 'computer', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ–±ï¸' },
        { name: 'å¤–æ¥ç¡¬ç›˜', subCat: 'computer', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ’¾' },
        { name: 'USB Hub', subCat: 'computer', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ”Œ' },
        { name: 'æ‘„åƒå¤´', subCat: 'computer', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ“¹' },
        
        // æ™ºèƒ½å®¶å±…
        { name: 'è·¯ç”±å™¨', subCat: 'home', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ“¡' },
        { name: 'æ™ºèƒ½ç¯æ³¡', subCat: 'home', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ’¡' },
        { name: 'æ™ºèƒ½æ’åº§', subCat: 'home', qty: 0, suggest: 0, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ”Œ' },
        { name: 'æ‰«åœ°æœºå™¨äºº', subCat: 'home', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ¤–' },
        { name: 'ç©ºæ°”å‡€åŒ–å™¨', subCat: 'home', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸŒ¬ï¸' },
        { name: 'åŠ æ¹¿å™¨', subCat: 'home', qty: 0, suggest: 0, unit: 'å°', condition: 'good', icon: 'ğŸ’§' },
        
        // é…ä»¶
        { name: 'Lightning çº¿', subCat: 'accessories', qty: 0, suggest: 3, unit: 'æ¡', condition: 'good', icon: 'ğŸ”Œ' },
        { name: 'USB-C çº¿', subCat: 'accessories', qty: 0, suggest: 3, unit: 'æ¡', condition: 'good', icon: 'ğŸ”Œ' },
        { name: 'å……ç”µå™¨ (20W)', subCat: 'accessories', qty: 0, suggest: 2, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ”Œ' },
        { name: 'å……ç”µå™¨ (65W+)', subCat: 'accessories', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ”Œ' },
        { name: 'MagSafe å……ç”µå™¨', subCat: 'accessories', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ”‹' },
        { name: 'ç§»åŠ¨ç”µæº', subCat: 'accessories', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ”‹' },
        { name: 'æ‰‹æœºå£³', subCat: 'accessories', qty: 0, suggest: 1, unit: 'ä¸ª', condition: 'good', icon: 'ğŸ“±' },
        { name: 'å±å¹•ä¿æŠ¤è†œ', subCat: 'accessories', qty: 0, suggest: 2, unit: 'å¼ ', condition: 'good', icon: 'ğŸ“±' },
        { name: 'SD å¡', subCat: 'accessories', qty: 0, suggest: 0, unit: 'å¼ ', condition: 'good', icon: 'ğŸ’¾' },
      ],
      supplements: [
        // èƒ½é‡èƒ¶
        { name: 'GUèƒ½é‡èƒ¶', subCat: 'energy', qty: 0, suggest: 6, unit: 'ä¸ª', icon: 'âš¡' },
        { name: 'SISèƒ½é‡èƒ¶', subCat: 'energy', qty: 0, suggest: 6, unit: 'ä¸ª', icon: 'âš¡' },
        { name: 'Maurtenèƒ½é‡èƒ¶', subCat: 'energy', qty: 0, suggest: 4, unit: 'ä¸ª', icon: 'âš¡' },
        { name: 'èƒ½é‡æ£’', subCat: 'energy', qty: 0, suggest: 6, unit: 'æ¡', icon: 'ğŸ«' },
        { name: 'èƒ½é‡è½¯ç³–', subCat: 'energy', qty: 0, suggest: 2, unit: 'åŒ…', icon: 'ğŸ¬' },
        
        // ç”µè§£è´¨
        { name: 'ç›ä¸¸ (SaltStick)', subCat: 'electrolyte', qty: 0, suggest: 30, unit: 'ç²’', icon: 'ğŸ’Š' },
        { name: 'ç”µè§£è´¨ç²‰', subCat: 'electrolyte', qty: 0, suggest: 2, unit: 'è¢‹', icon: 'ğŸ’Š' },
        { name: 'Nuunæ³¡è…¾ç‰‡', subCat: 'electrolyte', qty: 0, suggest: 2, unit: 'ç®¡', icon: 'ğŸ’Š' },
        { name: 'Hydralyte', subCat: 'electrolyte', qty: 0, suggest: 1, unit: 'ç›’', icon: 'ğŸ’Š' },
        
        // è›‹ç™½/å¢è‚Œ
        { name: 'è›‹ç™½ç²‰ (Whey)', subCat: 'protein', qty: 0, suggest: 1, unit: 'æ¡¶', icon: 'ğŸ¥¤' },
        { name: 'BCAA', subCat: 'protein', qty: 0, suggest: 1, unit: 'ç“¶', icon: 'ğŸ¥¤' },
        { name: 'è‚Œé…¸', subCat: 'protein', qty: 0, suggest: 1, unit: 'ç“¶', icon: 'ğŸ¥¤' },
        { name: 'è›‹ç™½æ£’', subCat: 'protein', qty: 0, suggest: 6, unit: 'æ¡', icon: 'ğŸ«' },
        
        // è¿åŠ¨é¥®æ–™
        { name: 'ä½³å¾—ä¹ç²‰', subCat: 'hydration', qty: 0, suggest: 1, unit: 'ç½', icon: 'ğŸ§ƒ' },
        { name: 'Powerade', subCat: 'hydration', qty: 0, suggest: 6, unit: 'ç“¶', icon: 'ğŸ§ƒ' },
        { name: 'æ¤°å­æ°´', subCat: 'hydration', qty: 0, suggest: 6, unit: 'ç“¶', icon: 'ğŸ¥¥' },
      ]
    };

    // å…¨å±€çŠ¶æ€
    let inventory = {};
    let settings = { lastSync: null };
    let currentView = 'main';
    let currentCategory = null;
    let currentSubTab = {};

    // ========== åˆå§‹åŒ– ==========
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      loadSettings();
      checkMonthlyDecrement(); // æ£€æŸ¥æœˆåº¦è‡ªåŠ¨å‡ä¸€
      renderAll();
      setTimeout(autoSyncOnLoad, 500);
      
      // å¤„ç† URL hash è·³è½¬åˆ°æŒ‡å®šåˆ†ç±»
      const hash = window.location.hash.slice(1);
      if (hash && MAIN_CATEGORIES[hash]) {
        setTimeout(() => showCategory(hash), 100);
      }
    });

    function loadData() {
      const saved = localStorage.getItem('family-inventory-v2');
      if (saved) {
        inventory = JSON.parse(saved);
      } else {
        // åˆå§‹åŒ–é»˜è®¤æ•°æ®
        inventory = {};
        Object.keys(DEFAULT_DATA).forEach(mainCat => {
          inventory[mainCat] = DEFAULT_DATA[mainCat].map((item, i) => ({
            ...item,
            id: Date.now() + Math.random() * 1000 + i,
            mainCat
          }));
        });
        saveData();
      }
    }

    function loadSettings() {
      const saved = localStorage.getItem('family-inventory-settings-v2');
      if (saved) settings = JSON.parse(saved);
    }
    
    // æœˆåº¦è‡ªåŠ¨å‡ä¸€åŠŸèƒ½ï¼ˆæ—¥ç”¨å“ï¼‰
    function checkMonthlyDecrement() {
      const now = new Date();
      const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
      const lastDecrement = settings.lastMonthlyDecrement || '';
      
      // å¦‚æœæœ¬æœˆè¿˜æ²¡æœ‰æ‰§è¡Œè¿‡å‡ä¸€
      if (lastDecrement !== currentMonth && inventory.daily) {
        let decremented = 0;
        
        inventory.daily.forEach(item => {
          // åªå¯¹æœ‰å»ºè®®å­˜é‡ä¸”å½“å‰æ•°é‡å¤§äº0çš„ç‰©å“å‡ä¸€
          if (item.suggest > 0 && item.qty > 0) {
            item.qty = Math.max(0, item.qty - 1);
            decremented++;
          }
        });
        
        if (decremented > 0) {
          settings.lastMonthlyDecrement = currentMonth;
          saveSettings();
          saveData();
          console.log(`ğŸ“‰ æœˆåº¦è‡ªåŠ¨å‡ä¸€: ${decremented} ä»¶æ—¥ç”¨å“æ•°é‡å·²å‡å°‘`);
          
          // æ˜¾ç¤ºæç¤º
          setTimeout(() => {
            showToast(`ğŸ“‰ æœˆåº¦æ›´æ–°: ${decremented}ä»¶æ—¥ç”¨å“è‡ªåŠ¨å‡ä¸€`);
          }, 1500);
        }
      }
    }

    function saveData() {
      localStorage.setItem('family-inventory-v2', JSON.stringify(inventory));
      showSaveStatus();
      scheduleCloudSave();
    }

    function saveSettings() {
      localStorage.setItem('family-inventory-settings-v2', JSON.stringify(settings));
    }

    function showSaveStatus() {
      const status = document.getElementById('saveStatus');
      status.classList.add('show');
      setTimeout(() => status.classList.remove('show'), 2000);
    }

    // ========== äº‘åŒæ­¥ ==========
    const SUPABASE_URL = 'https://syhwaeloljdswsmqkzrx.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5aHdhZWxvbGpkc3dzbXFrenJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxMDI0NjksImV4cCI6MjA4NTY3ODQ2OX0.wWe9fnjMe0d7PbXfF5s9hdY6rXHB4rCAbMzXhgbyTE8';
    const FAMILY_ID = 'dong-olivia-v2';
    let isSyncing = false;
    let supabaseClient = null;
    let cloudSaveTimeout = null;

    function initSupabase() {
      if (typeof window.supabase !== 'undefined') {
        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        return true;
      }
      return false;
    }

    async function syncCloud() {
      if (isSyncing || !supabaseClient) return;
      isSyncing = true;
      
      const btn = document.getElementById('syncBtn');
      const status = document.getElementById('syncStatus');
      
      btn.disabled = true;
      status.className = 'sync-status syncing';
      status.textContent = 'â³ åŒæ­¥ä¸­...';
      
      try {
        const { error } = await supabaseClient
          .from('inventory')
          .upsert({
            family_id: FAMILY_ID,
            items: inventory,
            updated_at: new Date().toISOString()
          }, { onConflict: 'family_id' });
        
        if (error) throw error;
        
        settings.lastSync = new Date().toISOString();
        saveSettings();
        
        status.className = 'sync-status synced';
        status.textContent = 'âœ… å·²åŒæ­¥';
        setTimeout(() => {
          status.textContent = 'â˜ï¸ ' + new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
        }, 1500);
        
      } catch (err) {
        console.error('Sync error:', err);
        status.className = 'sync-status error';
        status.textContent = 'âŒ ' + (err.message || 'åŒæ­¥å¤±è´¥');
      } finally {
        btn.disabled = false;
        isSyncing = false;
      }
    }

    async function autoSyncOnLoad() {
      if (!initSupabase()) {
        document.getElementById('syncStatus').textContent = 'âš ï¸ ç¦»çº¿æ¨¡å¼';
        return;
      }
      
      const status = document.getElementById('syncStatus');
      status.textContent = 'â³ è¿æ¥äº‘ç«¯...';
      status.className = 'sync-status syncing';
      
      try {
        const { data, error } = await supabaseClient
          .from('inventory')
          .select('*')
          .eq('family_id', FAMILY_ID)
          .single();
        
        if (error && error.code === 'PGRST116') {
          await syncCloud();
          status.textContent = 'â¬†ï¸ å·²ä¸Šä¼ ';
        } else if (data) {
          const cloudTime = new Date(data.updated_at).getTime();
          const localTime = new Date(settings.lastSync || 0).getTime();
          
          if (cloudTime > localTime) {
            inventory = data.items;
            localStorage.setItem('family-inventory-v2', JSON.stringify(inventory));
            settings.lastSync = data.updated_at;
            saveSettings();
            renderAll();
            status.textContent = 'â¬‡ï¸ å·²ä»äº‘ç«¯æ›´æ–°';
          } else {
            status.textContent = 'âœ… å·²æ˜¯æœ€æ–°';
          }
        }
        status.className = 'sync-status synced';
        subscribeToChanges();
      } catch (e) {
        console.error('Auto sync error:', e);
        status.textContent = 'âš ï¸ ç¦»çº¿æ¨¡å¼';
        status.className = 'sync-status';
      }
    }

    function subscribeToChanges() {
      if (!supabaseClient) return;
      
      supabaseClient
        .channel('inventory-realtime-v2')
        .on('postgres_changes', {
          event: '*',
          schema: 'public',
          table: 'inventory',
          filter: `family_id=eq.${FAMILY_ID}`
        }, (payload) => {
          if (payload.new && payload.new.items) {
            const cloudTime = new Date(payload.new.updated_at).getTime();
            const localTime = new Date(settings.lastSync || 0).getTime();
            
            if (cloudTime > localTime + 1000) {
              inventory = payload.new.items;
              localStorage.setItem('family-inventory-v2', JSON.stringify(inventory));
              settings.lastSync = payload.new.updated_at;
              saveSettings();
              renderAll();
              showToast('ğŸ“± å·²ä»å…¶ä»–è®¾å¤‡åŒæ­¥');
              document.getElementById('syncStatus').textContent = 'â¬‡ï¸ åˆšåˆšåŒæ­¥';
              document.getElementById('syncStatus').className = 'sync-status synced';
            }
          }
        })
        .subscribe();
    }

    function scheduleCloudSave() {
      if (!supabaseClient) return;
      clearTimeout(cloudSaveTimeout);
      cloudSaveTimeout = setTimeout(() => syncCloud(), 3000);
    }

    // ========== è§†å›¾åˆ‡æ¢ ==========
    function openCategory(cat) {
      currentView = cat;
      currentCategory = cat;
      
      document.getElementById('mainView').style.display = 'none';
      document.querySelectorAll('.category-view').forEach(v => v.classList.remove('active'));
      
      if (cat === 'shopping') {
        document.getElementById('shoppingView').classList.add('active');
        generateShoppingList();
      } else {
        document.getElementById(`${cat}View`).classList.add('active');
        renderCategoryView(cat);
      }
    }

    function goBack() {
      currentView = 'main';
      currentCategory = null;
      
      document.querySelectorAll('.category-view').forEach(v => v.classList.remove('active'));
      document.getElementById('mainView').style.display = 'block';
      renderAll();
    }

    function showSubTab(mainCat, subCat, btn) {
      currentSubTab[mainCat] = subCat;
      
      const tabs = btn.parentElement.querySelectorAll('.tab');
      tabs.forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      
      document.querySelectorAll(`#${mainCat}View .sub-tab-content`).forEach(c => {
        c.classList.remove('active');
        c.style.display = 'none';
      });
      
      const content = document.getElementById(`${mainCat}-${subCat}`);
      content.classList.add('active');
      content.style.display = 'block';
      
      if (subCat === 'add') {
        renderAddForm(mainCat);
      } else {
        renderSubCategoryItems(mainCat, subCat);
      }
    }

    // ========== æ¸²æŸ“ ==========
    function renderAll() {
      renderStats();
      renderAlerts();
      renderCategoryCounts();
    }

    function renderStats() {
      let total = 0, low = 0, out = 0;
      
      Object.values(inventory).forEach(items => {
        items.forEach(item => {
          total++;
          if (item.suggest > 0) {
            if (item.qty === 0) out++;
            else if (item.qty < item.suggest) low++;
          }
        });
      });
      
      document.getElementById('totalItems').textContent = total;
      document.getElementById('lowCount').textContent = low;
      document.getElementById('outCount').textContent = out;
    }

    function renderAlerts() {
      const alerts = [];
      
      // ä½åº“å­˜/ç¼ºè´§
      Object.values(inventory).forEach(items => {
        items.forEach(item => {
          if (item.suggest > 0 && item.qty === 0) {
            alerts.push({ type: 'out', item });
          } else if (item.suggest > 0 && item.qty < item.suggest) {
            alerts.push({ type: 'low', item });
          }
          // é£Ÿæè¿‡æœŸæ£€æŸ¥
          if (item.expiry) {
            const exp = new Date(item.expiry);
            const now = new Date();
            const days = Math.ceil((exp - now) / (1000 * 60 * 60 * 24));
            if (days <= 3 && days > 0) {
              alerts.push({ type: 'expiring', item, days });
            } else if (days <= 0) {
              alerts.push({ type: 'expired', item });
            }
          }
        });
      });
      
      const section = document.getElementById('alertSection');
      if (alerts.length === 0) {
        section.style.display = 'none';
        return;
      }
      
      let html = '';
      const expired = alerts.filter(a => a.type === 'expired');
      const expiring = alerts.filter(a => a.type === 'expiring');
      const out = alerts.filter(a => a.type === 'out');
      
      if (expired.length > 0) {
        html += `<strong style="color: var(--danger);">ğŸš¨ å·²è¿‡æœŸ:</strong> ${expired.slice(0,3).map(a => a.item.icon + ' ' + a.item.name).join('ã€')}<br>`;
      }
      if (expiring.length > 0) {
        html += `<strong style="color: var(--orange);">â° å³å°†è¿‡æœŸ:</strong> ${expiring.slice(0,3).map(a => a.item.icon + ' ' + a.item.name + '(' + a.days + 'å¤©)').join('ã€')}<br>`;
      }
      if (out.length > 0) {
        html += `<strong style="color: var(--danger);">âŒ å·²ç”¨å®Œ:</strong> ${out.slice(0,5).map(a => a.item.icon + ' ' + a.item.name).join('ã€')}`;
        if (out.length > 5) html += ` ç­‰${out.length}é¡¹`;
      }
      
      document.getElementById('alertList').innerHTML = html;
      section.style.display = 'block';
    }

    function renderCategoryCounts() {
      Object.keys(MAIN_CATEGORIES).forEach(cat => {
        const items = inventory[cat] || [];
        document.getElementById(`${cat}Count`).textContent = `${items.length} ä»¶`;
      });
      
      // é‡‡ä¹°æ¸…å•æ•°é‡
      let needBuy = 0;
      Object.values(inventory).forEach(items => {
        items.forEach(item => {
          if (item.suggest > 0 && item.qty < item.suggest) needBuy++;
        });
      });
      document.getElementById('shoppingListCount').textContent = `${needBuy} é¡¹`;
    }

    function renderCategoryView(mainCat) {
      const subCats = MAIN_CATEGORIES[mainCat].subCategories;
      const firstSubCat = Object.keys(subCats)[0];
      
      // åˆå§‹åŒ–æ‰€æœ‰å­åˆ†ç±»å†…å®¹
      Object.keys(subCats).forEach(subCat => {
        const el = document.getElementById(`${mainCat}-${subCat}`);
        if (el) {
          el.style.display = subCat === firstSubCat ? 'block' : 'none';
        }
      });
      
      // æ¸²æŸ“ç¬¬ä¸€ä¸ªå­åˆ†ç±»
      renderSubCategoryItems(mainCat, firstSubCat);
      
      // æ¸²æŸ“æ·»åŠ è¡¨å•å ä½
      const addEl = document.getElementById(`${mainCat}-add`);
      if (addEl) addEl.style.display = 'none';
    }

    function renderSubCategoryItems(mainCat, subCat) {
      const items = (inventory[mainCat] || []).filter(i => i.subCat === subCat);
      const container = document.getElementById(`${mainCat}-${subCat}`);
      
      if (!container) return;
      
      const catInfo = MAIN_CATEGORIES[mainCat].subCategories[subCat];
      
      if (items.length === 0) {
        container.innerHTML = `
          <div class="section">
            <div class="section-title">
              <span>${catInfo.icon} ${catInfo.name}</span>
              <span class="section-badge">0</span>
            </div>
            <div class="empty-state">
              <div class="emoji">ğŸ“­</div>
              <p>æš‚æ— ç‰©å“ï¼Œç‚¹å‡» â• æ·»åŠ </p>
            </div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div class="section">
          <div class="section-title">
            <span>${catInfo.icon} ${catInfo.name}</span>
            <span class="section-badge">${items.length}</span>
          </div>
          <div class="item-list">
            ${items.map(item => renderItem(item, mainCat)).join('')}
          </div>
        </div>
      `;
    }

    function renderItem(item, mainCat) {
      const status = getStatus(item);
      let metaHtml = '';
      
      if (item.suggest > 0) {
        metaHtml += `<span class="suggest">å»ºè®®: ${item.suggest}${item.unit || ''}</span>`;
      }
      if (item.location) {
        metaHtml += `<span>ğŸ“ ${item.location}</span>`;
      }
      if (item.expiry) {
        const exp = new Date(item.expiry);
        const now = new Date();
        const days = Math.ceil((exp - now) / (1000 * 60 * 60 * 24));
        if (days <= 0) {
          metaHtml += `<span class="expiry">ğŸš¨ å·²è¿‡æœŸ</span>`;
        } else if (days <= 3) {
          metaHtml += `<span class="expiry">â° ${days}å¤©åè¿‡æœŸ</span>`;
        } else {
          metaHtml += `<span>ğŸ“… ${item.expiry}</span>`;
        }
      }
      if (item.season && item.season !== 'all') {
        const seasonNames = { spring: 'æ˜¥', summer: 'å¤', autumn: 'ç§‹', winter: 'å†¬' };
        metaHtml += `<span class="season-tag ${item.season}">${seasonNames[item.season]}</span>`;
      }
      if (item.condition && item.condition !== 'good') {
        const condNames = { fair: 'ä¸€èˆ¬', worn: 'ç£¨æŸ', replace: 'éœ€æ¢' };
        metaHtml += `<span style="color: var(--warning);">âš ï¸ ${condNames[item.condition]}</span>`;
      }
      
      return `
        <div class="item ${status}">
          <div class="item-icon">${item.icon || 'ğŸ“¦'}</div>
          <div class="item-info" onclick="openEditModal('${mainCat}', ${item.id})" style="cursor: pointer;">
            <div class="item-name">${item.name}</div>
            <div class="item-meta">${metaHtml}</div>
          </div>
          <div class="item-actions">
            <div class="item-qty">
              <button class="qty-btn minus" onclick="updateQty('${mainCat}', ${item.id}, -1)">âˆ’</button>
              <span class="qty-value">${item.qty}</span>
              <button class="qty-btn plus" onclick="updateQty('${mainCat}', ${item.id}, 1)">+</button>
            </div>
            <button class="delete-btn" onclick="deleteItem('${mainCat}', ${item.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
          </div>
        </div>
      `;
    }

    function getStatus(item) {
      if (item.suggest > 0) {
        if (item.qty === 0) return 'out-of-stock';
        if (item.qty < item.suggest) return 'low-stock';
        return 'ok';
      }
      if (item.expiry) {
        const exp = new Date(item.expiry);
        const days = Math.ceil((exp - new Date()) / (1000 * 60 * 60 * 24));
        if (days <= 0) return 'out-of-stock';
        if (days <= 3) return 'expiring-soon';
      }
      if (item.condition === 'replace') return 'low-stock';
      return '';
    }

    function renderAddForm(mainCat) {
      const container = document.getElementById(`${mainCat}-add`);
      const subCats = MAIN_CATEGORIES[mainCat].subCategories;
      
      let extraFields = '';
      
      if (mainCat === 'food') {
        extraFields = `
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">ä¿è´¨æœŸ</label>
              <input type="date" class="form-input" id="add-expiry-${mainCat}">
            </div>
          </div>
        `;
      } else if (mainCat === 'clothing') {
        extraFields = `
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">å­£èŠ‚</label>
              <select class="form-select" id="add-season-${mainCat}">
                <option value="all">å››å­£é€šç”¨</option>
                <option value="spring">æ˜¥å­£</option>
                <option value="summer">å¤å­£</option>
                <option value="autumn">ç§‹å­£</option>
                <option value="winter">å†¬å­£</option>
              </select>
            </div>
          </div>
        `;
      } else if (mainCat === 'sports' || mainCat === 'electronics') {
        extraFields = `
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">çŠ¶æ€</label>
              <select class="form-select" id="add-condition-${mainCat}">
                <option value="good">è‰¯å¥½</option>
                <option value="fair">ä¸€èˆ¬</option>
                <option value="worn">ç£¨æŸ</option>
                <option value="replace">éœ€æ›´æ¢</option>
              </select>
            </div>
          </div>
        `;
      }
      
      container.innerHTML = `
        <div class="add-form">
          <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--accent-light);">â• æ·»åŠ ç‰©å“</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">ç‰©å“åç§° *</label>
              <input type="text" class="form-input" id="add-name-${mainCat}" placeholder="è¾“å…¥åç§°">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">å­åˆ†ç±»</label>
              <select class="form-select" id="add-subcat-${mainCat}">
                ${Object.entries(subCats).map(([key, val]) => 
                  `<option value="${key}">${val.icon} ${val.name}</option>`
                ).join('')}
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group small">
              <label class="form-label">æ•°é‡</label>
              <input type="number" class="form-input" id="add-qty-${mainCat}" value="1" min="0">
            </div>
            <div class="form-group small">
              <label class="form-label">å»ºè®®å­˜é‡</label>
              <input type="number" class="form-input" id="add-suggest-${mainCat}" value="0" min="0">
            </div>
            <div class="form-group">
              <label class="form-label">å•ä½</label>
              <input type="text" class="form-input" id="add-unit-${mainCat}" placeholder="ä¸ª/ä»¶/ç“¶">
            </div>
          </div>
          ${extraFields}
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">å­˜æ”¾ä½ç½®</label>
              <input type="text" class="form-input" id="add-location-${mainCat}" placeholder="å¯é€‰">
            </div>
          </div>
          <button class="btn btn-primary" onclick="addItem('${mainCat}')">â• æ·»åŠ </button>
        </div>
      `;
    }

    // ========== æ“ä½œ ==========
    function updateQty(mainCat, id, delta) {
      const item = (inventory[mainCat] || []).find(i => i.id === id);
      if (!item) return;
      
      item.qty = Math.max(0, item.qty + delta);
      saveData();
      
      if (currentView === mainCat) {
        renderSubCategoryItems(mainCat, item.subCat);
      }
      renderAll();
    }

    function deleteItem(mainCat, id) {
      const item = (inventory[mainCat] || []).find(i => i.id === id);
      if (!item) return;
      
      if (confirm(`ç¡®å®šåˆ é™¤ "${item.name}" å—ï¼Ÿ`)) {
        inventory[mainCat] = inventory[mainCat].filter(i => i.id !== id);
        saveData();
        
        if (currentView === mainCat) {
          renderSubCategoryItems(mainCat, item.subCat);
        }
        renderAll();
        showToast(`å·²åˆ é™¤ ${item.name}`);
      }
    }

    function addItem(mainCat) {
      const name = document.getElementById(`add-name-${mainCat}`).value.trim();
      if (!name) {
        showToast('è¯·è¾“å…¥ç‰©å“åç§°', 'warning');
        return;
      }
      
      const subCat = document.getElementById(`add-subcat-${mainCat}`).value;
      const qty = parseInt(document.getElementById(`add-qty-${mainCat}`).value) || 0;
      const suggest = parseInt(document.getElementById(`add-suggest-${mainCat}`).value) || 0;
      const unit = document.getElementById(`add-unit-${mainCat}`).value || '';
      const location = document.getElementById(`add-location-${mainCat}`).value || '';
      
      const newItem = {
        id: Date.now() + Math.random() * 1000,
        mainCat,
        subCat,
        name,
        qty,
        suggest,
        unit,
        location,
        icon: MAIN_CATEGORIES[mainCat].subCategories[subCat]?.icon || 'ğŸ“¦'
      };
      
      // é¢å¤–å­—æ®µ
      if (mainCat === 'food') {
        const expiry = document.getElementById(`add-expiry-${mainCat}`)?.value;
        if (expiry) newItem.expiry = expiry;
      } else if (mainCat === 'clothing') {
        newItem.season = document.getElementById(`add-season-${mainCat}`)?.value || 'all';
        newItem.condition = 'good';
      } else if (mainCat === 'sports' || mainCat === 'electronics') {
        newItem.condition = document.getElementById(`add-condition-${mainCat}`)?.value || 'good';
      }
      
      if (!inventory[mainCat]) inventory[mainCat] = [];
      inventory[mainCat].push(newItem);
      saveData();
      
      document.getElementById(`add-name-${mainCat}`).value = '';
      
      showToast(`å·²æ·»åŠ  ${name}`);
      renderAll();
    }

    function openEditModal(mainCat, id) {
      const item = (inventory[mainCat] || []).find(i => i.id === id);
      if (!item) return;
      
      document.getElementById('editId').value = id;
      document.getElementById('editMainCat').value = mainCat;
      document.getElementById('editName').value = item.name;
      document.getElementById('editQty').value = item.qty;
      document.getElementById('editSuggest').value = item.suggest || 0;
      document.getElementById('editNotes').value = item.notes || '';
      
      // æ¡ä»¶å­—æ®µ
      const expiryRow = document.getElementById('editExpiryRow');
      const seasonRow = document.getElementById('editSeasonRow');
      const conditionRow = document.getElementById('editConditionRow');
      
      expiryRow.style.display = mainCat === 'food' ? 'flex' : 'none';
      seasonRow.style.display = mainCat === 'clothing' ? 'flex' : 'none';
      conditionRow.style.display = ['sports', 'electronics', 'clothing'].includes(mainCat) ? 'flex' : 'none';
      
      if (mainCat === 'food') {
        document.getElementById('editExpiry').value = item.expiry || '';
      }
      if (mainCat === 'clothing') {
        document.getElementById('editSeason').value = item.season || 'all';
      }
      if (['sports', 'electronics', 'clothing'].includes(mainCat)) {
        document.getElementById('editCondition').value = item.condition || 'good';
      }
      
      document.getElementById('editModal').classList.remove('hidden');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
    }

    function saveEdit() {
      const id = parseFloat(document.getElementById('editId').value);
      const mainCat = document.getElementById('editMainCat').value;
      const item = (inventory[mainCat] || []).find(i => i.id === id);
      if (!item) return;
      
      item.name = document.getElementById('editName').value.trim() || item.name;
      item.qty = parseInt(document.getElementById('editQty').value) || 0;
      item.suggest = parseInt(document.getElementById('editSuggest').value) || 0;
      item.notes = document.getElementById('editNotes').value || '';
      
      if (mainCat === 'food') {
        item.expiry = document.getElementById('editExpiry').value || null;
      }
      if (mainCat === 'clothing') {
        item.season = document.getElementById('editSeason').value || 'all';
      }
      if (['sports', 'electronics', 'clothing'].includes(mainCat)) {
        item.condition = document.getElementById('editCondition').value || 'good';
      }
      
      saveData();
      closeEditModal();
      
      if (currentView === mainCat) {
        renderSubCategoryItems(mainCat, item.subCat);
      }
      renderAll();
      showToast('å·²ä¿å­˜ä¿®æ”¹');
    }

    // ========== æœç´¢ ==========
    function handleSearch(query) {
      const resultsEl = document.getElementById('searchResults');
      const gridEl = document.getElementById('categoryGrid');
      
      if (!query.trim()) {
        resultsEl.style.display = 'none';
        gridEl.style.display = 'grid';
        return;
      }
      
      const q = query.toLowerCase();
      const results = [];
      
      Object.entries(inventory).forEach(([mainCat, items]) => {
        items.forEach(item => {
          if (item.name.toLowerCase().includes(q) || 
              (item.location && item.location.toLowerCase().includes(q))) {
            results.push({ ...item, mainCat });
          }
        });
      });
      
      gridEl.style.display = 'none';
      resultsEl.style.display = 'block';
      
      if (results.length === 0) {
        resultsEl.innerHTML = `
          <div class="section">
            <div class="empty-state">
              <p>æœªæ‰¾åˆ° "${query}"</p>
            </div>
          </div>
        `;
        return;
      }
      
      resultsEl.innerHTML = `
        <div class="section">
          <div class="section-title">
            <span>ğŸ” æœç´¢ç»“æœ</span>
            <span class="section-badge">${results.length}</span>
          </div>
          <div class="item-list">
            ${results.map(item => renderItem(item, item.mainCat)).join('')}
          </div>
        </div>
      `;
    }

    // ========== é‡‡ä¹°æ¸…å• ==========
    // å…¨å±€å­˜å‚¨é‡‡ä¹°æ¸…å•å’Œä¸´æ—¶ç‰©å“
    let currentShoppingList = [];
    let quickItems = JSON.parse(localStorage.getItem('quick-shopping-items') || '[]');
    
    // æ¸²æŸ“ä¸´æ—¶ç‰©å“åˆ—è¡¨
    function renderQuickItems() {
      const container = document.getElementById('quickItemsList');
      if (!container) return;
      
      if (quickItems.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      container.innerHTML = quickItems.map((item, i) => `
        <div class="shopping-item" style="padding: 8px 0;">
          <span class="shopping-text">ğŸ“ ${item}</span>
          <button class="delete-btn" onclick="removeQuickItem(${i})" style="opacity: 1;">âœ•</button>
        </div>
      `).join('');
    }
    
    // æ·»åŠ ä¸´æ—¶ç‰©å“
    function addQuickItem() {
      const input = document.getElementById('quickAddItem');
      const text = input.value.trim();
      if (!text) return;
      
      quickItems.push(text);
      localStorage.setItem('quick-shopping-items', JSON.stringify(quickItems));
      input.value = '';
      renderQuickItems();
      showToast(`å·²æ·»åŠ : ${text}`);
    }
    
    // åˆ é™¤ä¸´æ—¶ç‰©å“
    function removeQuickItem(index) {
      quickItems.splice(index, 1);
      localStorage.setItem('quick-shopping-items', JSON.stringify(quickItems));
      renderQuickItems();
    }
    
    // æ¸…ç©ºä¸´æ—¶ç‰©å“
    function clearQuickItems() {
      quickItems = [];
      localStorage.setItem('quick-shopping-items', JSON.stringify(quickItems));
      renderQuickItems();
    }
    
    function generateShoppingList() {
      const needBuy = [];
      
      // åªåŒ…å«æ—¥ç”¨å“ (daily) å’Œé£Ÿæ (food)
      ['daily', 'food'].forEach(mainCat => {
        const items = inventory[mainCat] || [];
        items.forEach(item => {
          if (item.suggest > 0 && item.qty < item.suggest) {
            needBuy.push({ ...item, mainCat, need: item.suggest - item.qty });
          }
        });
      });
      
      // ä¿å­˜åˆ°å…¨å±€å˜é‡
      currentShoppingList = needBuy;
      
      const list = document.getElementById('shoppingList');
      const count = document.getElementById('shoppingCount');
      const appleSection = document.getElementById('appleExportSection');
      
      const totalCount = needBuy.length + quickItems.length;
      count.textContent = totalCount;
      
      // æ¸²æŸ“ä¸´æ—¶ç‰©å“
      renderQuickItems();
      
      if (totalCount === 0) {
        list.innerHTML = '<div class="empty-state"><div class="emoji">âœ…</div><p>åº“å­˜å……è¶³ï¼Œä¸éœ€è¦é‡‡ä¹°ï¼</p></div>';
        appleSection.style.display = 'none';
        return;
      }
      
      // æ˜¾ç¤º Apple å¯¼å‡ºæŒ‰é’®
      appleSection.style.display = 'block';
      
      // æŒ‰ä¸»åˆ†ç±»æ’åº
      needBuy.sort((a, b) => a.mainCat.localeCompare(b.mainCat));
      
      let html = '';
      
      // åº“å­˜ç‰©å“
      if (needBuy.length > 0) {
        html += needBuy.map(item => `
          <div class="shopping-item" data-main="${item.mainCat}" data-id="${item.id}">
            <div class="shopping-check" onclick="toggleCheck(this)"></div>
            <span class="shopping-text">
              ${item.icon || 'ğŸ“¦'} ${item.name} 
              <span style="color: var(--warning);">(éœ€è¡¥${item.need}${item.unit || ''})</span>
            </span>
          </div>
        `).join('');
      }
      
      list.innerHTML = html || '<div class="empty-state"><p style="font-size: 12px;">åº“å­˜å……è¶³</p></div>';
      
      showToast(`ğŸ“‹ ç”Ÿæˆäº† ${totalCount} é¡¹é‡‡ä¹°æ¸…å•`);
    }
    
    function syncToApple() {
      const totalItems = currentShoppingList.length + quickItems.length;
      if (totalItems === 0) {
        showToast('æ²¡æœ‰éœ€è¦è´­ä¹°çš„ç‰©å“', 'warning');
        return;
      }
      
      const today = new Date().toISOString().slice(0, 10);
      const tz = '+11:00'; // Sydney timezone
      const catNames = {
        daily: 'æ—¥ç”¨å“',
        food: 'é£Ÿæ'
      };
      
      // ç”Ÿæˆ shell è„šæœ¬
      let script = `#!/bin/bash
# ğŸ›’ å®¶åº­é‡‡ä¹°æ¸…å• - ${today}
# è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·åœ¨ Mac ä¸Šè¿è¡Œ

echo "ğŸ›’ æ­£åœ¨åŒæ­¥é‡‡ä¹°æ¸…å•åˆ° Apple..."
echo ""

# ========== 1. æ·»åŠ åˆ° Apple Reminders ==========
echo "ğŸ“ æ·»åŠ æé†’äº‹é¡¹..."

# ç¡®ä¿æœ‰ Shopping åˆ—è¡¨
remindctl list "Family Shopping" --create 2>/dev/null || true

`;
      
      // æ·»åŠ ä¸´æ—¶ç‰©å“
      if (quickItems.length > 0) {
        script += `# --- ä¸´æ—¶æ·»åŠ  ---\n`;
        quickItems.forEach(item => {
          const escapedTitle = item.replace(/"/g, '\\"').replace(/\$/g, '\\$');
          script += `remindctl add --title "ğŸ“ ${escapedTitle}" --list "Family Shopping" --due today\n`;
        });
        script += '\n';
      }
      
      // æŒ‰åˆ†ç±»åˆ†ç»„åº“å­˜ç‰©å“
      const grouped = {};
      currentShoppingList.forEach(item => {
        const cat = catNames[item.mainCat] || 'å…¶ä»–';
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(item);
      });
      
      // æ·»åŠ æ¯ä¸ªç‰©å“åˆ° Reminders
      Object.entries(grouped).forEach(([cat, items]) => {
        script += `# --- ${cat} ---\n`;
        items.forEach(item => {
          const title = `${item.icon || 'ğŸ“¦'} ${item.name} (${item.need}${item.unit || 'ä¸ª'})`;
          const escapedTitle = title.replace(/"/g, '\\"').replace(/\$/g, '\\$');
          script += `remindctl add --title "${escapedTitle}" --list "Family Shopping" --due today\n`;
        });
        script += '\n';
      });
      
      // æ·»åŠ æ—¥å†äº‹ä»¶ (12:05-12:10 AM)
      script += `
# ========== 2. æ·»åŠ æ—¥å†äº‹ä»¶ ==========
echo ""
echo "ğŸ“… æ·»åŠ è´­ç‰©æ—¥å†äº‹ä»¶..."

# åˆ›å»ºç®€çŸ­äº‹ä»¶ (12:05-12:10 AM)
gog calendar create primary \\
  --summary "ğŸ›’ è´­ç‰©æé†’ - ${totalItems}ä»¶å¾…ä¹°" \\
  --from "${today}T00:05:00${tz}" \\
  --to "${today}T00:10:00${tz}" \\
  --event-color 6

echo ""
echo "âœ… å®Œæˆï¼"
echo "   - ${totalItems} ä¸ªæé†’å·²æ·»åŠ åˆ° Reminders â†’ Family Shopping"
echo "   - 1 ä¸ªæ—¥å†æé†’å·²æ·»åŠ  (12:05 AM)"
echo ""
echo "æ‰“å¼€ Reminders æŸ¥çœ‹: open -a Reminders"
`;
      
      // ä¸‹è½½è„šæœ¬
      const blob = new Blob([script], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `shopping-sync-${today}.sh`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('ğŸ“¥ è„šæœ¬å·²ä¸‹è½½ï¼Œè¯·åœ¨ Mac ç»ˆç«¯è¿è¡Œ');
    }

    function toggleCheck(el) {
      el.classList.toggle('checked');
      el.parentElement.querySelector('.shopping-text').classList.toggle('checked');
    }

    function markAllBought() {
      const items = document.querySelectorAll('.shopping-item');
      items.forEach(el => {
        const mainCat = el.dataset.main;
        const id = parseFloat(el.dataset.id);
        const item = (inventory[mainCat] || []).find(i => i.id === id);
        if (item && item.suggest > 0) {
          item.qty = item.suggest;
        }
      });
      saveData();
      generateShoppingList();
      renderAll();
      showToast('ğŸ‰ å·²å…¨éƒ¨è¡¥è´§å®Œæˆï¼');
    }

    function clearChecked() {
      document.querySelectorAll('.shopping-check.checked').forEach(el => {
        el.classList.remove('checked');
        el.parentElement.querySelector('.shopping-text').classList.remove('checked');
      });
      showToast('å·²æ¸…é™¤æ ‡è®°');
    }

    // ========== æ•°æ®ç®¡ç† ==========
    function exportData() {
      const data = { 
        inventory, 
        settings,
        exportedAt: new Date().toISOString(),
        version: '3.0'
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `family-inventory-${new Date().toISOString().slice(0,10)}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ğŸ“¤ æ•°æ®å·²å¯¼å‡º');
    }

    function importClick() {
      document.getElementById('importFile').click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.inventory) {
            inventory = data.inventory;
            if (data.settings) {
              settings = data.settings;
              saveSettings();
            }
            saveData();
            renderAll();
            showToast(`ğŸ“¥ æˆåŠŸå¯¼å…¥æ•°æ®`);
          } else {
            showToast('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'warning');
          }
        } catch (err) {
          showToast('å¯¼å…¥å¤±è´¥: ' + err.message, 'warning');
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    // ========== å·¥å…· ==========
    function showToast(msg, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.background = type === 'warning' ? 'var(--warning)' : 'var(--success)';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // å…³é—­å¼¹çª— (ç‚¹å‡»èƒŒæ™¯)
    document.getElementById('editModal').addEventListener('click', (e) => {
      if (e.target.id === 'editModal') closeEditModal();
    });
  </script>
</body>
</html>
