<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1e3a5f">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ </text></svg>">
  <title>ğŸ  å®¶åº­æ—¥å¸¸åº“å­˜</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --card-hover: #334155;
      --accent: #3b82f6;
      --accent-light: #60a5fa;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --border: #334155;
      --input-bg: #0f172a;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      padding-bottom: 120px;
    }
    .container { max-width: 500px; margin: 0 auto; }
    
    header { text-align: center; padding: 16px 0 20px; }
    h1 { font-size: 22px; margin-bottom: 4px; }
    .subtitle { color: var(--muted); font-size: 12px; }
    .save-status {
      font-size: 10px;
      color: var(--success);
      margin-top: 4px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .save-status.show { opacity: 1; }
    
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    .stat-card {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    .stat-value.warning { color: var(--warning); }
    .stat-value.danger { color: var(--danger); }
    .stat-label {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    .stocktake-reminder {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .stocktake-reminder .text {
      font-size: 12px;
      color: var(--accent-light);
    }
    .stocktake-reminder .date {
      font-size: 11px;
      color: var(--muted);
    }
    .stocktake-reminder .btn-small {
      padding: 6px 12px;
      font-size: 11px;
      background: var(--accent);
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }

    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
    }
    .tab {
      padding: 10px 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
      transition: all 0.2s;
    }
    .tab.active {
      background: var(--accent);
      border-color: var(--accent);
    }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .section {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .section-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--accent-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .section-badge {
      font-size: 11px;
      padding: 4px 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      color: var(--muted);
    }
    
    .item-list { display: flex; flex-direction: column; gap: 8px; }
    
    .item {
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid rgba(255,255,255,0.05);
      transition: all 0.2s;
      position: relative;
    }
    .item.low-stock {
      border-color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
    }
    .item.out-of-stock {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    .item.ok {
      border-color: rgba(34, 197, 94, 0.3);
    }
    
    .item-icon {
      font-size: 22px;
      width: 36px;
      text-align: center;
    }
    .item-info { flex: 1; min-width: 0; }
    .item-name {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .item-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      gap: 8px;
    }
    .item-meta .suggest { color: var(--accent-light); }
    
    .item-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .item-qty {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .qty-btn {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .qty-btn:hover { border-color: var(--accent); }
    .qty-btn.minus { color: var(--danger); }
    .qty-btn.plus { color: var(--success); }
    .qty-value {
      font-size: 14px;
      font-weight: 700;
      min-width: 24px;
      text-align: center;
    }
    .delete-btn {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 14px;
      cursor: pointer;
      opacity: 0.5;
      transition: all 0.2s;
    }
    .delete-btn:hover {
      opacity: 1;
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .add-form {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    .form-group { flex: 1; }
    .form-group.small { flex: 0 0 70px; }
    .form-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 13px;
    }
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn-primary {
      background: var(--accent);
      color: white;
      width: 100%;
    }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-success {
      background: var(--success);
      color: white;
    }
    .btn-warning {
      background: var(--warning);
      color: white;
    }
    .btn-large {
      padding: 16px 24px;
      font-size: 15px;
      margin-bottom: 12px;
    }
    
    .quick-add {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .quick-btn {
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
    }
    .quick-btn:hover { border-color: var(--accent); }
    
    .shopping-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .shopping-item:last-child { border-bottom: none; }
    .shopping-check {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 2px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .shopping-check.checked {
      background: var(--success);
      border-color: var(--success);
    }
    .shopping-check.checked::after {
      content: 'âœ“';
      color: white;
      font-size: 12px;
    }
    .shopping-text { flex: 1; font-size: 13px; }
    .shopping-text.checked {
      text-decoration: line-through;
      color: var(--muted);
    }
    
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--success);
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 13px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    .empty-state .emoji { font-size: 48px; margin-bottom: 12px; }

    .alert-card {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(239, 68, 68, 0.15));
      border: 1px solid var(--warning);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .alert-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--warning);
      margin-bottom: 8px;
    }
    .alert-list {
      font-size: 12px;
      line-height: 1.6;
    }
    
    .edit-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    .edit-modal.hidden { display: none; }
    .edit-modal-content {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      width: 100%;
      max-width: 360px;
    }
    .edit-modal h3 {
      font-size: 16px;
      margin-bottom: 16px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ  å®¶åº­æ—¥å¸¸åº“å­˜</h1>
      <p class="subtitle">Dong & Olivia Â· å®šæœŸé‡‡ä¹°ç®¡ç†</p>
      <p class="save-status" id="saveStatus">âœ… å·²è‡ªåŠ¨ä¿å­˜</p>
    </header>

    <div id="stocktakeReminder" class="stocktake-reminder" style="display: none;">
      <div>
        <div class="text">ğŸ“‹ è¯¥åš Stocktake äº†ï¼</div>
        <div class="date" id="stocktakeDate"></div>
      </div>
      <button class="btn-small" onclick="dismissStocktake()">å®Œæˆç›˜ç‚¹</button>
    </div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="totalItems">0</div>
        <div class="stat-label">ç‰©å“ç§ç±»</div>
      </div>
      <div class="stat-card">
        <div class="stat-value warning" id="lowCount">0</div>
        <div class="stat-label">éœ€è¡¥è´§</div>
      </div>
      <div class="stat-card">
        <div class="stat-value danger" id="outCount">0</div>
        <div class="stat-label">å·²ç”¨å®Œ</div>
      </div>
    </div>

    <div id="alertSection" class="alert-card" style="display: none;">
      <div class="alert-title">âš ï¸ ä½åº“å­˜è­¦å‘Š</div>
      <div class="alert-list" id="alertList"></div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="medicine" onclick="showTab('medicine', this)">ğŸ’Š è¯å“</button>
      <button class="tab" data-tab="hygiene" onclick="showTab('hygiene', this)">ğŸ§´ å«ç”Ÿ</button>
      <button class="tab" data-tab="cleaning" onclick="showTab('cleaning', this)">ğŸ§¹ æ¸…æ´</button>
      <button class="tab" data-tab="kitchen" onclick="showTab('kitchen', this)">ğŸ³ å¨æˆ¿</button>
      <button class="tab" data-tab="other" onclick="showTab('other', this)">ğŸ“¦ å…¶ä»–</button>
      <button class="tab" data-tab="shopping" onclick="showTab('shopping', this)">ğŸ›’ é‡‡ä¹°</button>
      <button class="tab" data-tab="add" onclick="showTab('add', this)">â• æ·»åŠ </button>
    </div>

    <!-- è¯å“ -->
    <div id="medicine" class="tab-content active">
      <div class="section">
        <div class="section-title">
          <span>ğŸ’Š å¸¸å¤‡è¯å“</span>
          <span class="section-badge" id="medicineCount">0</span>
        </div>
        <div class="item-list" id="medicineList"></div>
      </div>
    </div>

    <!-- å«ç”Ÿç”¨å“ -->
    <div id="hygiene" class="tab-content">
      <div class="section">
        <div class="section-title">
          <span>ğŸ§´ å«ç”Ÿç”¨å“</span>
          <span class="section-badge" id="hygieneCount">0</span>
        </div>
        <div class="item-list" id="hygieneList"></div>
      </div>
    </div>

    <!-- æ¸…æ´ç”¨å“ -->
    <div id="cleaning" class="tab-content">
      <div class="section">
        <div class="section-title">
          <span>ğŸ§¹ æ¸…æ´ç”¨å“</span>
          <span class="section-badge" id="cleaningCount">0</span>
        </div>
        <div class="item-list" id="cleaningList"></div>
      </div>
    </div>

    <!-- å¨æˆ¿ç”¨å“ -->
    <div id="kitchen" class="tab-content">
      <div class="section">
        <div class="section-title">
          <span>ğŸ³ å¨æˆ¿è€—æ</span>
          <span class="section-badge" id="kitchenCount">0</span>
        </div>
        <div class="item-list" id="kitchenList"></div>
      </div>
    </div>

    <!-- å…¶ä»– -->
    <div id="other" class="tab-content">
      <div class="section">
        <div class="section-title">
          <span>ğŸ“¦ å…¶ä»–ç”¨å“</span>
          <span class="section-badge" id="otherCount">0</span>
        </div>
        <div class="item-list" id="otherList"></div>
      </div>
    </div>

    <!-- é‡‡ä¹°æ¸…å• -->
    <div id="shopping" class="tab-content">
      <button class="btn btn-warning btn-large" onclick="generateShoppingList()">
        ğŸ›’ ç”Ÿæˆé‡‡ä¹°æ¸…å•
      </button>
      <div class="section">
        <div class="section-title">
          <span>ğŸ“ éœ€è¦è´­ä¹°</span>
          <span class="section-badge" id="shoppingCount">0</span>
        </div>
        <div id="shoppingList"></div>
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn btn-success" style="flex: 1;" onclick="markAllBought()">âœ… å…¨éƒ¨ä¹°é½</button>
        <button class="btn btn-secondary" style="flex: 1;" onclick="clearChecked()">ğŸ”„ æ¸…é™¤æ ‡è®°</button>
      </div>
    </div>

    <!-- æ·»åŠ  -->
    <div id="add" class="tab-content">
      <div class="add-form">
        <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--accent-light);">â• æ·»åŠ æ–°ç‰©å“</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ç‰©å“åç§° *</label>
            <input type="text" class="form-input" id="itemName" placeholder="ä¾‹å¦‚ï¼šPanadol">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group small">
            <label class="form-label">å½“å‰æ•°é‡</label>
            <input type="number" class="form-input" id="itemQty" value="0" min="0">
          </div>
          <div class="form-group small">
            <label class="form-label">å»ºè®®å­˜é‡</label>
            <input type="number" class="form-input" id="itemSuggest" value="1" min="1">
          </div>
          <div class="form-group">
            <label class="form-label">å•ä½</label>
            <select class="form-select" id="itemUnit">
              <option value="ç›’">ç›’</option>
              <option value="ç“¶">ç“¶</option>
              <option value="åŒ…">åŒ…</option>
              <option value="ä¸ª">ä¸ª</option>
              <option value="å·">å·</option>
              <option value="è¢‹">è¢‹</option>
              <option value="æ”¯">æ”¯</option>
              <option value="ç‰‡">ç‰‡</option>
              <option value="æ¡">æ¡</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">åˆ†ç±»</label>
            <select class="form-select" id="itemCategory">
              <option value="medicine">ğŸ’Š è¯å“</option>
              <option value="hygiene">ğŸ§´ å«ç”Ÿç”¨å“</option>
              <option value="cleaning">ğŸ§¹ æ¸…æ´ç”¨å“</option>
              <option value="kitchen">ğŸ³ å¨æˆ¿è€—æ</option>
              <option value="other">ğŸ“¦ å…¶ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">å­˜æ”¾ä½ç½®</label>
            <select class="form-select" id="itemLocation">
              <option value="è¯ç®±">ğŸ’Š è¯ç®±</option>
              <option value="æµ´å®¤æŸœ">ğŸš¿ æµ´å®¤æŸœ</option>
              <option value="æ´—è¡£æˆ¿">ğŸ§º æ´—è¡£æˆ¿</option>
              <option value="å¨æˆ¿">ğŸ³ å¨æˆ¿</option>
              <option value="å‚¨ç‰©é—´">ğŸ“¦ å‚¨ç‰©é—´</option>
              <option value="å®¢å…">ğŸ›‹ï¸ å®¢å…</option>
              <option value="ç„å…³">ğŸšª ç„å…³</option>
              <option value="å…¶ä»–">ğŸ“ å…¶ä»–</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary" onclick="addItem()">â• æ·»åŠ ç‰©å“</button>
      </div>

      <div class="section">
        <div class="section-title">âš¡ å¿«é€Ÿæ·»åŠ å¸¸ç”¨ç‰©å“</div>
        <div class="quick-add" id="quickAddBtns"></div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ’¾ æ•°æ®ç®¡ç†</div>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
          <button class="btn btn-secondary" style="flex: 1;" onclick="importClick()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
        </div>
        <button class="btn btn-secondary" style="width: 100%; color: var(--danger);" onclick="resetData()">ğŸ—‘ï¸ é‡ç½®ä¸ºé»˜è®¤</button>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
      </div>
    </div>
  </div>

  <!-- ç¼–è¾‘å¼¹çª— -->
  <div class="edit-modal hidden" id="editModal">
    <div class="edit-modal-content">
      <h3>âœï¸ ç¼–è¾‘ç‰©å“</h3>
      <input type="hidden" id="editId">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ç‰©å“åç§°</label>
          <input type="text" class="form-input" id="editName">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group small">
          <label class="form-label">æ•°é‡</label>
          <input type="number" class="form-input" id="editQty" min="0">
        </div>
        <div class="form-group small">
          <label class="form-label">å»ºè®®å­˜é‡</label>
          <input type="number" class="form-input" id="editSuggest" min="1">
        </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 16px;">
        <button class="btn btn-secondary" style="flex: 1;" onclick="closeEditModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" style="flex: 1;" onclick="saveEdit()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // é»˜è®¤ç‰©å“æ•°æ®ï¼ˆæ¾³æ´²30-40å²å¤«å¦»å®¶åº­ï¼‰
    const defaultItems = [
      // è¯å“
      { name: 'Panadol æ­¢ç—›ç‰‡', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ’Š' },
      { name: 'Nurofen å¸ƒæ´›èŠ¬', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ’Š' },
      { name: 'æ„Ÿå†’è¯ (Codral)', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ¤§' },
      { name: 'åˆ›å¯è´´', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ©¹' },
      { name: 'Dettol æ¶ˆæ¯’æ¶²', category: 'medicine', suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸ§´' },
      { name: 'çƒ«ä¼¤è† (Burnaid)', category: 'medicine', suggest: 1, unit: 'æ”¯', location: 'è¯ç®±', icon: 'ğŸ”¥' },
      { name: 'æ­¢æ³»è¯ (Imodium)', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸ’Š' },
      { name: 'æŠ—è¿‡æ•è¯ (Zyrtec)', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸŒ¸' },
      { name: 'çœ¼è¯æ°´', category: 'medicine', suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸ‘ï¸' },
      { name: 'ä½“æ¸©è®¡', category: 'medicine', suggest: 1, unit: 'ä¸ª', location: 'è¯ç®±', icon: 'ğŸŒ¡ï¸' },
      { name: 'ç»´ç”Ÿç´ C', category: 'medicine', suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸŠ' },
      { name: 'ç»´ç”Ÿç´ D', category: 'medicine', suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'â˜€ï¸' },
      { name: 'è‚ èƒƒè¯ (Gaviscon)', category: 'medicine', suggest: 1, unit: 'ç“¶', location: 'è¯ç®±', icon: 'ğŸ’Š' },
      { name: 'æ™•è½¦è¯', category: 'medicine', suggest: 1, unit: 'ç›’', location: 'è¯ç®±', icon: 'ğŸš—' },
      
      // å«ç”Ÿç”¨å“
      { name: 'ç‰™è†', category: 'hygiene', suggest: 2, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸ¦·' },
      { name: 'ç‰™åˆ·', category: 'hygiene', suggest: 4, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸª¥' },
      { name: 'ç‰™çº¿', category: 'hygiene', suggest: 1, unit: 'ç›’', location: 'æµ´å®¤æŸœ', icon: 'ğŸ¦·' },
      { name: 'æ¼±å£æ°´', category: 'hygiene', suggest: 1, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ’§' },
      { name: 'æ´—å‘æ°´', category: 'hygiene', suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
      { name: 'æŠ¤å‘ç´ ', category: 'hygiene', suggest: 1, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
      { name: 'æ²æµ´éœ²', category: 'hygiene', suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§¼' },
      { name: 'æ´—é¢å¥¶', category: 'hygiene', suggest: 2, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
      { name: 'é¢éœœ/ä¹³æ¶²', category: 'hygiene', suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
      { name: 'é˜²æ™’éœœ', category: 'hygiene', suggest: 2, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'â˜€ï¸' },
      { name: 'å«ç”Ÿå·¾/æ£‰æ¡', category: 'hygiene', suggest: 2, unit: 'åŒ…', location: 'æµ´å®¤æŸœ', icon: 'ğŸ©¹' },
      { name: 'å«ç”Ÿçº¸', category: 'hygiene', suggest: 2, unit: 'åŒ…', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§»' },
      { name: 'é¢å·¾çº¸', category: 'hygiene', suggest: 2, unit: 'ç›’', location: 'å®¢å…', icon: 'ğŸ§»' },
      { name: 'æ£‰ç­¾', category: 'hygiene', suggest: 1, unit: 'ç›’', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§µ' },
      { name: 'æ£‰ç‰‡/åŒ–å¦†æ£‰', category: 'hygiene', suggest: 1, unit: 'åŒ…', location: 'æµ´å®¤æŸœ', icon: 'âšª' },
      { name: 'å‰ƒé¡»åˆ€ç‰‡', category: 'hygiene', suggest: 1, unit: 'ç›’', location: 'æµ´å®¤æŸœ', icon: 'ğŸª’' },
      { name: 'é™¤è‡­å‰‚', category: 'hygiene', suggest: 2, unit: 'æ”¯', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
      { name: 'èº«ä½“ä¹³', category: 'hygiene', suggest: 1, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸ§´' },
      
      // æ¸…æ´ç”¨å“
      { name: 'æ´—è¡£æ¶²', category: 'cleaning', suggest: 2, unit: 'ç“¶', location: 'æ´—è¡£æˆ¿', icon: 'ğŸ§º' },
      { name: 'æŸ”é¡ºå‰‚', category: 'cleaning', suggest: 1, unit: 'ç“¶', location: 'æ´—è¡£æˆ¿', icon: 'ğŸŒ¸' },
      { name: 'æ´—æ´ç²¾', category: 'cleaning', suggest: 2, unit: 'ç“¶', location: 'å¨æˆ¿', icon: 'ğŸ§´' },
      { name: 'å¤šåŠŸèƒ½æ¸…æ´å‰‚', category: 'cleaning', suggest: 1, unit: 'ç“¶', location: 'å‚¨ç‰©é—´', icon: 'ğŸ§¹' },
      { name: 'ç»ç’ƒæ¸…æ´å‰‚', category: 'cleaning', suggest: 1, unit: 'ç“¶', location: 'å‚¨ç‰©é—´', icon: 'ğŸªŸ' },
      { name: 'é©¬æ¡¶æ¸…æ´å‰‚', category: 'cleaning', suggest: 1, unit: 'ç“¶', location: 'æµ´å®¤æŸœ', icon: 'ğŸš½' },
      { name: 'æ¶ˆæ¯’æ¹¿å·¾', category: 'cleaning', suggest: 2, unit: 'åŒ…', location: 'å‚¨ç‰©é—´', icon: 'ğŸ§»' },
      { name: 'æµ·ç»µ/ç™¾æ´å¸ƒ', category: 'cleaning', suggest: 1, unit: 'åŒ…', location: 'å¨æˆ¿', icon: 'ğŸ§½' },
      { name: 'æŠ¹å¸ƒ', category: 'cleaning', suggest: 4, unit: 'æ¡', location: 'å¨æˆ¿', icon: 'ğŸ§¹' },
      { name: 'åƒåœ¾è¢‹ (å¤§)', category: 'cleaning', suggest: 1, unit: 'å·', location: 'å‚¨ç‰©é—´', icon: 'ğŸ—‘ï¸' },
      { name: 'åƒåœ¾è¢‹ (å°)', category: 'cleaning', suggest: 1, unit: 'å·', location: 'å‚¨ç‰©é—´', icon: 'ğŸ—‘ï¸' },
      { name: 'æ‹–æŠŠæ›¿æ¢å¤´', category: 'cleaning', suggest: 2, unit: 'ä¸ª', location: 'å‚¨ç‰©é—´', icon: 'ğŸ§¹' },
      
      // å¨æˆ¿è€—æ
      { name: 'ä¿é²œè†œ', category: 'kitchen', suggest: 2, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸï¸' },
      { name: 'é”¡ç®”çº¸', category: 'kitchen', suggest: 1, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸª©' },
      { name: 'çƒ˜ç„™çº¸', category: 'kitchen', suggest: 1, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸ“œ' },
      { name: 'å¨æˆ¿çº¸å·¾', category: 'kitchen', suggest: 2, unit: 'å·', location: 'å¨æˆ¿', icon: 'ğŸ§»' },
      { name: 'æ´—ç¢—æµ·ç»µ', category: 'kitchen', suggest: 3, unit: 'ä¸ª', location: 'å¨æˆ¿', icon: 'ğŸ§½' },
      { name: 'ä¿é²œè¢‹', category: 'kitchen', suggest: 1, unit: 'ç›’', location: 'å¨æˆ¿', icon: 'ğŸ‘œ' },
      { name: 'é£Ÿç‰©å¯†å°è¢‹', category: 'kitchen', suggest: 1, unit: 'ç›’', location: 'å¨æˆ¿', icon: 'ğŸ“¦' },
      
      // å…¶ä»–
      { name: 'ç”µæ±  (AA)', category: 'other', suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©é—´', icon: 'ğŸ”‹' },
      { name: 'ç”µæ±  (AAA)', category: 'other', suggest: 1, unit: 'åŒ…', location: 'å‚¨ç‰©é—´', icon: 'ğŸ”‹' },
      { name: 'ç¯æ³¡', category: 'other', suggest: 2, unit: 'ä¸ª', location: 'å‚¨ç‰©é—´', icon: 'ğŸ’¡' },
      { name: 'é›¨ä¼', category: 'other', suggest: 2, unit: 'æŠŠ', location: 'ç„å…³', icon: 'â˜”' },
      { name: 'æ‰‹ç”µç­’', category: 'other', suggest: 1, unit: 'ä¸ª', location: 'å‚¨ç‰©é—´', icon: 'ğŸ”¦' },
      { name: 'èœ¡çƒ›', category: 'other', suggest: 1, unit: 'ç›’', location: 'å‚¨ç‰©é—´', icon: 'ğŸ•¯ï¸' },
      { name: 'Opalå¡', category: 'other', suggest: 2, unit: 'å¼ ', location: 'ç„å…³', icon: 'ğŸ’³' },
    ];

    let inventory = [];
    let settings = {
      lastStocktake: null,
      stocktakeDismissed: null
    };

    // å¿«é€Ÿæ·»åŠ æŒ‰é’®
    const quickAddItems = [
      { name: 'Panadol', cat: 'medicine', suggest: 1, unit: 'ç›’', loc: 'è¯ç®±' },
      { name: 'å«ç”Ÿçº¸', cat: 'hygiene', suggest: 2, unit: 'åŒ…', loc: 'æµ´å®¤æŸœ' },
      { name: 'æ´—è¡£æ¶²', cat: 'cleaning', suggest: 2, unit: 'ç“¶', loc: 'æ´—è¡£æˆ¿' },
      { name: 'ä¿é²œè†œ', cat: 'kitchen', suggest: 2, unit: 'å·', loc: 'å¨æˆ¿' },
      { name: 'åƒåœ¾è¢‹', cat: 'cleaning', suggest: 1, unit: 'å·', loc: 'å‚¨ç‰©é—´' },
      { name: 'ç‰™è†', cat: 'hygiene', suggest: 2, unit: 'æ”¯', loc: 'æµ´å®¤æŸœ' },
    ];

    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      loadSettings();
      renderQuickAdd();
      renderAll();
      checkStocktakeReminder();
    });

    function loadData() {
      const saved = localStorage.getItem('home-inventory');
      if (saved) {
        inventory = JSON.parse(saved);
      } else {
        // é¦–æ¬¡ä½¿ç”¨ï¼ŒåŠ è½½é»˜è®¤ç‰©å“
        inventory = defaultItems.map((item, i) => ({
          ...item,
          id: Date.now() + i,
          qty: 0 // åˆå§‹æ•°é‡ä¸º0ï¼Œç­‰ç”¨æˆ·ç›˜ç‚¹
        }));
        saveData();
      }
    }

    function loadSettings() {
      const saved = localStorage.getItem('home-inventory-settings');
      if (saved) {
        settings = JSON.parse(saved);
      }
    }

    function saveSettings() {
      localStorage.setItem('home-inventory-settings', JSON.stringify(settings));
    }

    function saveData() {
      localStorage.setItem('home-inventory', JSON.stringify(inventory));
      showSaveStatus();
    }

    function showSaveStatus() {
      const status = document.getElementById('saveStatus');
      status.classList.add('show');
      setTimeout(() => status.classList.remove('show'), 2000);
    }

    function checkStocktakeReminder() {
      const today = new Date();
      const day = today.getDate();
      const month = today.getMonth();
      const year = today.getFullYear();
      
      // æ¯æœˆ15å·æé†’
      if (day >= 15 && day <= 20) {
        const thisMonth15 = new Date(year, month, 15).toISOString().slice(0, 10);
        
        // å¦‚æœè¿™ä¸ªæœˆè¿˜æ²¡å®Œæˆç›˜ç‚¹
        if (settings.stocktakeDismissed !== thisMonth15) {
          document.getElementById('stocktakeReminder').style.display = 'flex';
          document.getElementById('stocktakeDate').textContent = `æœ¬æœˆç›˜ç‚¹æ—¥: ${month + 1}æœˆ15æ—¥`;
        }
      }
    }

    function dismissStocktake() {
      const today = new Date();
      settings.stocktakeDismissed = new Date(today.getFullYear(), today.getMonth(), 15).toISOString().slice(0, 10);
      settings.lastStocktake = today.toISOString();
      saveSettings();
      document.getElementById('stocktakeReminder').style.display = 'none';
      showToast('âœ… å·²å®Œæˆæœ¬æœˆç›˜ç‚¹');
    }

    function renderQuickAdd() {
      document.getElementById('quickAddBtns').innerHTML = quickAddItems.map(item => 
        `<button class="quick-btn" onclick="quickAdd('${item.name}', '${item.cat}', ${item.suggest}, '${item.unit}', '${item.loc}')">${item.name}</button>`
      ).join('');
    }

    function renderAll() {
      renderInventory();
      renderStats();
      renderAlerts();
      generateShoppingList();
    }

    function renderInventory() {
      const categories = ['medicine', 'hygiene', 'cleaning', 'kitchen', 'other'];
      
      categories.forEach(cat => {
        const items = inventory.filter(i => i.category === cat);
        const list = document.getElementById(`${cat}List`);
        const count = document.getElementById(`${cat}Count`);
        
        count.textContent = items.length;
        
        if (items.length === 0) {
          list.innerHTML = '<div class="empty-state"><p style="font-size: 12px;">æš‚æ— ç‰©å“</p></div>';
          return;
        }

        list.innerHTML = items.map(item => {
          const status = getStatus(item);
          return `
            <div class="item ${status}">
              <div class="item-icon">${item.icon || 'ğŸ“¦'}</div>
              <div class="item-info" onclick="openEditModal(${item.id})" style="cursor: pointer;">
                <div class="item-name">${item.name}</div>
                <div class="item-meta">
                  <span class="suggest">å»ºè®®: ${item.suggest}${item.unit}</span>
                  <span>ğŸ“ ${item.location}</span>
                </div>
              </div>
              <div class="item-actions">
                <div class="item-qty">
                  <button class="qty-btn minus" onclick="updateQty(${item.id}, -1)">âˆ’</button>
                  <span class="qty-value">${item.qty}</span>
                  <button class="qty-btn plus" onclick="updateQty(${item.id}, 1)">+</button>
                </div>
                <button class="delete-btn" onclick="deleteItem(${item.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
              </div>
            </div>
          `;
        }).join('');
      });
    }

    function renderStats() {
      document.getElementById('totalItems').textContent = inventory.length;
      
      const low = inventory.filter(i => i.qty > 0 && i.qty < i.suggest).length;
      const out = inventory.filter(i => i.qty === 0).length;
      
      document.getElementById('lowCount').textContent = low;
      document.getElementById('outCount').textContent = out;
    }

    function renderAlerts() {
      const lowStock = inventory.filter(i => i.qty > 0 && i.qty < i.suggest);
      const outOfStock = inventory.filter(i => i.qty === 0);
      const section = document.getElementById('alertSection');
      
      if (lowStock.length > 0 || outOfStock.length > 0) {
        let alertHtml = '';
        
        if (outOfStock.length > 0) {
          alertHtml += '<strong style="color: var(--danger);">âŒ å·²ç”¨å®Œ:</strong><br>';
          alertHtml += outOfStock.slice(0, 5).map(i => 
            `${i.icon || 'ğŸ“¦'} ${i.name}`
          ).join('ã€');
          if (outOfStock.length > 5) alertHtml += ` ç­‰${outOfStock.length}é¡¹`;
          alertHtml += '<br><br>';
        }
        
        if (lowStock.length > 0) {
          alertHtml += '<strong style="color: var(--warning);">âš ï¸ åº“å­˜ä¸è¶³:</strong><br>';
          alertHtml += lowStock.slice(0, 5).map(i => 
            `${i.icon || 'ğŸ“¦'} ${i.name} (${i.qty}/${i.suggest})`
          ).join('ã€');
          if (lowStock.length > 5) alertHtml += ` ç­‰${lowStock.length}é¡¹`;
        }
        
        document.getElementById('alertList').innerHTML = alertHtml;
        section.style.display = 'block';
      } else {
        section.style.display = 'none';
      }
    }

    function generateShoppingList() {
      const needBuy = inventory.filter(i => i.qty < i.suggest);
      const list = document.getElementById('shoppingList');
      const count = document.getElementById('shoppingCount');
      
      count.textContent = needBuy.length;
      
      if (needBuy.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="emoji">âœ…</div><p>åº“å­˜å……è¶³ï¼Œä¸éœ€è¦é‡‡ä¹°ï¼</p></div>';
        return;
      }

      // æŒ‰åˆ†ç±»æ’åº
      const sorted = needBuy.sort((a, b) => a.category.localeCompare(b.category));

      list.innerHTML = sorted.map((item, i) => {
        const need = item.suggest - item.qty;
        return `
          <div class="shopping-item" data-id="${item.id}">
            <div class="shopping-check" onclick="toggleCheck(this)"></div>
            <span class="shopping-text">${item.icon || 'ğŸ“¦'} ${item.name} <span style="color: var(--warning);">(éœ€è¡¥${need}${item.unit})</span></span>
          </div>
        `;
      }).join('');
      
      showToast(`ğŸ“‹ ç”Ÿæˆäº† ${needBuy.length} é¡¹é‡‡ä¹°æ¸…å•`);
    }

    function getStatus(item) {
      if (item.qty === 0) return 'out-of-stock';
      if (item.qty < item.suggest) return 'low-stock';
      return 'ok';
    }

    function updateQty(id, delta) {
      const item = inventory.find(i => i.id === id);
      if (!item) return;
      
      item.qty = Math.max(0, item.qty + delta);
      saveData();
      renderAll();
    }

    function deleteItem(id) {
      const item = inventory.find(i => i.id === id);
      if (!item) return;
      
      if (confirm(`ç¡®å®šåˆ é™¤ "${item.name}" å—ï¼Ÿ`)) {
        inventory = inventory.filter(i => i.id !== id);
        saveData();
        renderAll();
        showToast(`å·²åˆ é™¤ ${item.name}`);
      }
    }

    function openEditModal(id) {
      const item = inventory.find(i => i.id === id);
      if (!item) return;
      
      document.getElementById('editId').value = id;
      document.getElementById('editName').value = item.name;
      document.getElementById('editQty').value = item.qty;
      document.getElementById('editSuggest').value = item.suggest;
      document.getElementById('editModal').classList.remove('hidden');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
    }

    function saveEdit() {
      const id = parseInt(document.getElementById('editId').value);
      const item = inventory.find(i => i.id === id);
      if (!item) return;
      
      item.name = document.getElementById('editName').value.trim() || item.name;
      item.qty = parseInt(document.getElementById('editQty').value) || 0;
      item.suggest = parseInt(document.getElementById('editSuggest').value) || 1;
      
      saveData();
      renderAll();
      closeEditModal();
      showToast('å·²ä¿å­˜ä¿®æ”¹');
    }

    function addItem() {
      const name = document.getElementById('itemName').value.trim();
      const qty = parseInt(document.getElementById('itemQty').value) || 0;
      const category = document.getElementById('itemCategory').value;
      const suggest = parseInt(document.getElementById('itemSuggest').value) || 1;
      const unit = document.getElementById('itemUnit').value;
      const location = document.getElementById('itemLocation').value;

      if (!name) {
        showToast('è¯·è¾“å…¥ç‰©å“åç§°', 'warning');
        return;
      }

      inventory.push({
        id: Date.now(),
        name,
        qty,
        category,
        suggest,
        unit,
        location,
        icon: 'ğŸ“¦'
      });

      saveData();
      renderAll();
      
      document.getElementById('itemName').value = '';
      document.getElementById('itemQty').value = '0';
      
      showToast(`å·²æ·»åŠ  ${name}`);
    }

    function quickAdd(name, cat, suggest, unit, loc) {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      if (inventory.some(i => i.name.toLowerCase().includes(name.toLowerCase()))) {
        showToast(`${name} å·²å­˜åœ¨`, 'warning');
        return;
      }
      
      inventory.push({
        id: Date.now(),
        name,
        qty: 0,
        category: cat,
        suggest,
        unit,
        location: loc,
        icon: 'ğŸ“¦'
      });
      saveData();
      renderAll();
      showToast(`å·²æ·»åŠ  ${name}`);
    }

    function toggleCheck(el) {
      el.classList.toggle('checked');
      el.parentElement.querySelector('.shopping-text').classList.toggle('checked');
    }

    function markAllBought() {
      const items = document.querySelectorAll('.shopping-item');
      items.forEach(item => {
        const id = parseInt(item.dataset.id);
        const invItem = inventory.find(i => i.id === id);
        if (invItem) {
          invItem.qty = invItem.suggest; // è¡¥æ»¡åˆ°å»ºè®®å­˜é‡
        }
      });
      saveData();
      renderAll();
      showToast('ğŸ‰ å·²å…¨éƒ¨è¡¥è´§å®Œæˆï¼');
    }

    function clearChecked() {
      document.querySelectorAll('.shopping-check.checked').forEach(el => {
        el.classList.remove('checked');
        el.parentElement.querySelector('.shopping-text').classList.remove('checked');
      });
      showToast('å·²æ¸…é™¤æ ‡è®°');
    }

    function showTab(tabId, btn) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    function showToast(msg, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.background = type === 'warning' ? 'var(--warning)' : 'var(--success)';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function exportData() {
      const data = { 
        inventory, 
        settings,
        exportedAt: new Date().toISOString(),
        version: '2.0'
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `home-inventory-${new Date().toISOString().slice(0,10)}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ğŸ“¤ æ•°æ®å·²å¯¼å‡º');
    }

    function importClick() {
      document.getElementById('importFile').click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.inventory && Array.isArray(data.inventory)) {
            inventory = data.inventory;
            if (data.settings) {
              settings = data.settings;
              saveSettings();
            }
            saveData();
            renderAll();
            showToast(`ğŸ“¥ æˆåŠŸå¯¼å…¥ ${inventory.length} ä¸ªç‰©å“`);
          } else {
            showToast('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'warning');
          }
        } catch (err) {
          showToast('å¯¼å…¥å¤±è´¥: ' + err.message, 'warning');
        }
      };
      reader.readAsText(file);
      event.target.value = ''; // æ¸…ç©ºä»¥ä¾¿é‡æ–°é€‰æ‹©
    }

    function resetData() {
      if (confirm('âš ï¸ ç¡®å®šé‡ç½®æ‰€æœ‰æ•°æ®ï¼Ÿ\n\nå°†æ¢å¤é»˜è®¤ç‰©å“åˆ—è¡¨ï¼Œæ‰€æœ‰è‡ªå®šä¹‰æ•°æ®å°†ä¸¢å¤±ã€‚')) {
        localStorage.removeItem('home-inventory');
        localStorage.removeItem('home-inventory-settings');
        loadData();
        loadSettings();
        renderAll();
        showToast('å·²æ¢å¤é»˜è®¤è®¾ç½®');
      }
    }

    // å…³é—­å¼¹çª— (ç‚¹å‡»èƒŒæ™¯)
    document.getElementById('editModal').addEventListener('click', (e) => {
      if (e.target.id === 'editModal') {
        closeEditModal();
      }
    });
  </script>
</body>
</html>
